<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ldxx.dao.tWimMsgDao">

    <sql id="StationIP_sql">
        <if test="stationPort!=null and stationPort!=''">
            <if test="stationPort.indexOf(',')!=-1">
                a.Station_IP in
                <foreach collection="stationPort.split(',')" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
            <if test="stationPort.indexOf(',')==-1">
                a.Station_IP=#{stationPort}
            </if>
            ORDER BY a.Evt_Time desc limit 5
        </if>
    </sql>
    <sql id="StationIP_sql_tongji">
        <if test="tjq.stationPort!=null and tjq.stationPort!=''">
            <if test="tjq.stationPort.indexOf(',')!=-1">
                and a.Station_IP in
                <foreach collection="tjq.stationPort.split(',')" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
            <if test="tjq.stationPort.indexOf(',')==-1">
                and a.Station_IP=#{tjq.stationPort}
            </if>
            /*ORDER BY a.Evt_Time desc*/
        </if>
    </sql>
    <sql id="CheXing_IP_sql_tongji">
        <if test="tjq.chexing!=null and tjq.chexing!=''">
            and FIND_IN_SET(a.Class_Index,#{tjq.chexing})
        </if>
    </sql>
    <sql id="StationIP_chaozaishuju_sql">
        <if test="stationPort!=null and stationPort!=''">
            <if test="stationPort.indexOf(',')!=-1">
                a.Station_IP in
                <foreach collection="stationPort.split(',')" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
            <if test="stationPort.indexOf(',')==-1">
                a.Station_IP=#{stationPort}
            </if>
            ORDER BY a.Evt_Time desc
        </if>
    </sql>

    <select id="getAlltWimMsg" resultType="tWimMsgVo">
        select CASE a.Direction WHEN 0 THEN '正常行驶'
        ELSE '逆行'
        END as directionName,
        CASE a.Is_Straddle WHEN 0 THEN '否'
        ELSE '是'
        end as isStraddleName,
        CASE a.Lane_No WHEN 1 THEN '超车道'
        WHEN 2 THEN '行车道'
        ELSE '应急车道'
        end as laneNoName,
        CASE WHEN a.Over_Weight_Ratio>0 THEN '超重'
        ELSE '不超重'
        end as overWeightRatioName,
        a.*,b.Station_Name,b.Route_Name,concat_ws("+",b.Station_Name,b.Route_Name) as stationNameRouteName,
        c.License_Plate_Color,d.Vehicle_Type_Name
        from (SELECT a.* from t_vehicle_msg a where <include refid="StationIP_sql"></include>) a
        LEFT JOIN station_site b on a.Station_IP=b.Station_Port
        LEFT JOIN license_plate c ON a.Plate_Color=c.License_Plate_No
        LEFT JOIN vehicle_type d ON a.Class_Index=d.Vehicle_Type_No

    </select>

    <select id="getAlltWimMsgByCondition" resultType="tWimMsgVo">
        SELECT
        CASE aa.Direction
        WHEN 0 THEN
        '正常行驶'
        ELSE
        '逆行'
        END AS directionName,
        CASE aa.Is_Straddle
        WHEN 0 THEN
        '否'
        ELSE
        '是'
        END AS isStraddleName,
        CASE aa.Lane_No WHEN 1 THEN '超车道'
        WHEN 2 THEN '行车道'
        ELSE '应急车道'
        end as laneNoName,
        CASE WHEN aa.Over_Weight_Ratio>0 THEN '超重'
        ELSE '不超重'
        end as overWeightRatioName,
        aa.*, b.Station_Name,
        b.Route_Name,
        concat_ws(
        "+",
        b.Station_Name,
        b.Route_Name
        ) AS stationNameRouteName,
        c.License_Plate_Color,
        d.Vehicle_Type_Name
        FROM
        (select * from t_vehicle_msg a
        <where>
            <if test="tjq.startTime!=null and tjq.startTime!='' ">
                and #{tjq.startTime} &lt;= msg_time
            </if>
            <if test="tjq.endTime!=null and tjq.endTime!='' ">
                and msg_time &lt;= #{tjq.endTime}
            </if>
            <if test="tjq.startWeight!=null and tjq.startWeight!='' ">
                and #{tjq.startWeight} &lt; total_weight
            </if>
            <if test="tjq.endWeight!=null and tjq.endWeight!='' ">
                and total_weight &lt; #{tjq.endWeight}
            </if>

            <if test="tjq.chesuStart!=null and tjq.chesuStart!='' ">
                and #{tjq.chesuStart} &lt; speed
            </if>
            <if test="tjq.chesuEnd!=null and tjq.chesuEnd!='' ">
                and speed &lt; #{tjq.chesuEnd}
            </if>

            <if test="tjq.roadTmpStart!=null and tjq.roadTmpStart!='' ">
                and #{tjq.roadTmpStart} &lt; Temperature
            </if>
            <if test="tjq.roadTmpEnd!=null and tjq.roadTmpEnd!='' ">
                and Temperature &lt; #{tjq.roadTmpEnd}
            </if>

            <if test="tjq.chaozhongStart!=null and tjq.chaozhongStart!='' ">
                and #{tjq.chaozhongStart} &lt; Over_Weight_Ratio
            </if>
            <if test="tjq.chaozhongEnd!=null and tjq.chaozhongEnd!='' ">
                and Over_Weight_Ratio &lt; #{tjq.chaozhongEnd}
            </if>

            <if test="tjq.chepai!=null and tjq.chepai!='' ">
                and Plate like CONCAT('%',#{tjq.chepai},'%')
            </if>

            <if test="tjq.zhoushu!=null and tjq.zhoushu!='' ">
                and Axles_Count = #{tjq.zhoushu}
            </if>


            <include refid="CheXing_IP_sql_tongji">
            </include>
            <include refid="StationIP_sql_tongji">
            </include>

        </where>
        ORDER BY
        Evt_Time DESC LIMIT #{tjq.start},
        #{tjq.length}) aa
        LEFT JOIN station_site b ON aa.Station_IP = b.Station_Port
        LEFT JOIN license_plate c ON aa.Plate_Color = c.License_Plate_No
        LEFT JOIN vehicle_type d ON aa.Class_Index = d.Vehicle_Type_No

    </select>

    <select id="getMeiRiCheLiuLiangByStationPort" resultType="int">
        SELECT COUNT(*) from t_vehicle_msg_today where  Station_IP=#{stationPort} AND date(Evt_Time) = curdate()
    </select>
    <select id="getMeiRiCheLiuLiangMaxByStationPort" resultType="int">
       SELECT IFNULL(max(a.cnt),0) FROM (SELECT COUNT(*) cnt FROM t_vehicle_msg_today WHERE date(Evt_Time) = curdate() GROUP BY Station_IP)a
    </select>

    <select id="getMeiRiChaoZhongByStationPort" resultType="int">
        SELECT COUNT(*) from t_vehicle_msg_today where  Station_IP=#{stationPort} AND date(Evt_Time) = curdate() and Over_Weight>0
    </select>



    <select id="getChaoZaiEchartsList" resultType="CheLiuLiangEchartsList">

            SELECT
                    group_concat(aa.cntc SEPARATOR ',') AS nums,
                    group_concat(
                        aa.Station_Port SEPARATOR ','
                    ) AS station_ports,
                    group_concat(
                        aa.station_name SEPARATOR ','
                    ) AS station_names,
                    group_concat(aa.cnta SEPARATOR ',') AS numCount,
                    group_concat(aa.cntt SEPARATOR ',') AS nums2
                FROM
                    (
                        SELECT
                            COUNT(
                                CASE
                                WHEN a.Station_IP IS NOT NULL THEN
                                    0
                                END
                            ) cntc,
                            b.Station_Port,
                            b.Station_Name,
                                                cc.cnt as cnta,
                                                (cc.cnt - COUNT(
                                CASE
                                WHEN a.Station_IP IS NOT NULL THEN
                                    0
                                END
                            )) as cntt


                        FROM
                            t_vehicle_msg_today a
                        RIGHT JOIN station_site b ON a.Station_IP = b.Station_Port AND a.Over_Weight>0 AND date(a.Evt_Time) = curdate()
                    RIGHT JOIN(
                                    SELECT
                                        COUNT(0) cntc
                                    FROM
                                        t_vehicle_msg_today

                                    WHERE
                                        Over_Weight>0 AND
                                        date(Evt_Time) = curdate() AND
                                        FIND_IN_SET(
                                            Station_IP,
                                            #{stationPorts}
                                        )
                                    ) c on 1=1
                                RIGHT JOIN(SELECT
                                            COUNT(
                                                CASE
                                                WHEN a.Station_IP IS NOT NULL THEN
                                                    0
                                                END
                                            ) cnt,
                                            bb.Station_Port,
                                            bb.Station_Name
                                            FROM
                                                t_vehicle_msg_today a
                                            RIGHT JOIN station_site bb ON a.Station_IP = bb.Station_Port AND date(a.Evt_Time) = curdate()
                                            GROUP BY
                                                bb.Station_Port
                                            HAVING FIND_IN_SET(bb.Station_Port,#{stationPorts})
                                            ORDER BY
                                                cnt DESC) cc on cc.Station_Port = b.Station_Port
                                                GROUP BY
                                                    b.Station_Port
                                                HAVING
                                                    FIND_IN_SET(
                                                        b.Station_Port,
                                                         #{stationPorts}
                                                    )
                                                ORDER BY
                                                    cntc DESC
                                                LIMIT 6
                                            ) aa
    </select>


    <select id="getCountByTableName" resultType="int">
        SELECT COUNT(*) from t_vehicle_msg a
        <where>
            <if test="tjq.startTime!=null and tjq.startTime!='' ">
                and #{tjq.startTime} &lt;= msg_time
            </if>
            <if test="tjq.endTime!=null and tjq.endTime!='' ">
                and msg_time &lt;= #{tjq.endTime}
            </if>
            <if test="tjq.startWeight!=null and tjq.startWeight!='' ">
                and #{tjq.startWeight} &lt; total_weight
            </if>
            <if test="tjq.endWeight!=null and tjq.endWeight!='' ">
                and total_weight &lt; #{tjq.endWeight}
            </if>

            <if test="tjq.chesuStart!=null and tjq.chesuStart!='' ">
                and #{tjq.chesuStart} &lt; speed
            </if>
            <if test="tjq.chesuEnd!=null and tjq.chesuEnd!='' ">
                and speed &lt; #{tjq.chesuEnd}
            </if>

            <if test="tjq.roadTmpStart!=null and tjq.roadTmpStart!='' ">
                and #{tjq.roadTmpStart} &lt; Temperature
            </if>
            <if test="tjq.roadTmpEnd!=null and tjq.roadTmpEnd!='' ">
                and Temperature &lt; #{tjq.roadTmpEnd}
            </if>

            <if test="tjq.chaozhongStart!=null and tjq.chaozhongStart!='' ">
                and #{tjq.chaozhongStart} &lt; Over_Weight_Ratio
            </if>
            <if test="tjq.chaozhongEnd!=null and tjq.chaozhongEnd!='' ">
                and Over_Weight_Ratio &lt; #{tjq.chaozhongEnd}
            </if>

            <if test="tjq.chepai!=null and tjq.chepai!='' ">
                and Plate like CONCAT('%',#{tjq.chepai},'%')
            </if>

            <if test="tjq.zhoushu!=null and tjq.zhoushu!='' ">
                and Axles_Count = #{tjq.zhoushu}
            </if>


            <include refid="CheXing_IP_sql_tongji">
            </include>
            <include refid="StationIP_sql_tongji">
            </include>

        </where>
    </select>

    <select id="getMeiRiGuanJianCheLiangByStationPort" resultType="int">
        SELECT COUNT(*) from t_vehicle_msg_today
        where  Station_IP=#{stationPort} AND date(Evt_Time) = curdate() and Total_Weight>(SELECT Crux_Weight FROM crux_weight where Del_State=1)
    </select>


    <select id="getHomeData" resultType="HomeData">
        SELECT * from (
        SELECT COUNT(*) totalChaoZai FROM t_vehicle_msg_today a WHERE a.Over_Weight>0 and FIND_IN_SET(a.Station_IP,#{stationPorts}) and  date(a.Evt_Time) = curdate()
        ) aa LEFT JOIN (
        select MAX(a.Total_Weight) maxWeight FROM t_vehicle_msg_today a WHERE  FIND_IN_SET(a.Station_IP,#{stationPorts}) and  date(a.Evt_Time) = curdate()
        )bb on 1= 1
        LEFT JOIN (
        select COUNT(*) totalCheLiu FROM t_vehicle_msg_today a WHERE  FIND_IN_SET(a.Station_IP,#{stationPorts}) and  date(a.Evt_Time) = curdate()
        )cc on 1= 1
    </select>

    <select id="getCheLiuLiangEchartsList" resultType="CheLiuLiangEchartsList">
        SELECT
        group_concat(aa.cnt SEPARATOR ',') AS nums,
        group_concat(aa.Station_Port SEPARATOR ',') AS station_ports,
        group_concat(aa.station_name SEPARATOR ',') AS station_names
        FROM
		(
			SELECT * FROM(SELECT
			COUNT(
				CASE
				WHEN a.Station_IP IS NOT NULL THEN
					0
				END
			) cnt,
			b.Station_Port,
			b.Station_Name
			FROM
				t_vehicle_msg_today a
			RIGHT JOIN station_site b ON a.Station_IP = b.Station_Port AND date(a.Evt_Time) = curdate()
			GROUP BY
				b.Station_Port
			HAVING FIND_IN_SET(b.Station_Port,#{stationPorts})
			ORDER BY
				cnt DESC
			LIMIT 6)dd ORDER BY dd.cnt
		) aa
    </select>

    <select id="getGuanJianChaoZhongCheLiangEchartsList" resultType="CheLiuLiangEchartsList">
        SELECT
                 group_concat(aaa.cnt SEPARATOR ',') AS cnt2,
                group_concat(aaa.Station_Port SEPARATOR ',') AS stationPorts,
                group_concat(aaa.Station_Name SEPARATOR ',') AS stationNames,
                group_concat(aaa.cnt2 SEPARATOR ',') AS cnt3
                FROM
                (select aa.cnt ,
        aa.Station_Port ,
        aa.Station_Name ,
        IFNULL(bb.cnt ,0)cnt2
                 from (SELECT
                            *
                        FROM
                    (
                        SELECT
                            COUNT(
                                CASE
                                WHEN a.Station_IP IS NOT NULL THEN
                                    0
                                END
                            ) cnt,
                            b.Station_Port,
                            b.Station_Name
                        FROM
                            t_vehicle_msg_today a
                        RIGHT JOIN station_site b ON a.Station_IP = b.Station_Port
                        AND date(a.Evt_Time) = curdate()
                        AND a.Total_Weight >= (
                            SELECT
                                Crux_Weight
                            FROM
                                crux_weight w
                            WHERE
                                Del_State = 1
                            AND w.lv = #{lv1}

                        )
                        GROUP BY
                            b.Station_Port
                        HAVING
                            FIND_IN_SET(b.Station_Port ,#{stationPorts})
                        ORDER BY
                            cnt DESC
                        LIMIT 6
                    ) dd
                ORDER BY
                    dd.cnt) aa LEFT JOIN (SELECT
                    *
                FROM
                    (
                        SELECT
                            COUNT(
                                CASE
                                WHEN a.Station_IP IS NOT NULL THEN
                                    0
                                END
                            ) cnt,
                            b.Station_Port,
                            b.Station_Name
                        FROM
                            t_vehicle_msg_today a
                        RIGHT JOIN station_site b ON a.Station_IP = b.Station_Port
                        AND date(a.Evt_Time) = curdate()
                        AND a.Total_Weight >= (
                            SELECT
                                Crux_Weight
                            FROM
                                crux_weight w
                            WHERE
                                Del_State = 1
                            AND w.lv = #{lv2}

                        )
                        GROUP BY
                            b.Station_Port
                        HAVING
                            FIND_IN_SET(b.Station_Port ,#{stationPorts})
                        ORDER BY
                            cnt DESC
                        LIMIT 6
                    ) dd
                ORDER BY
                    dd.cnt) bb on aa.Station_Port = bb.Station_Port ORDER BY aa.cnt desc
                ) aaa

    </select>


    <select id="getMeiRiGuanJianCheLiangMax" resultType="int">
        SELECT  IFNULL(max(a.cnt),0) FROM (SELECT COUNT(*) cnt from t_vehicle_msg_today
        where   date(Evt_Time) = curdate() and Total_Weight>(SELECT Crux_Weight FROM crux_weight where Del_State=1) GROUP BY Station_IP)a
    </select>

    <select id="getMeiRiCheLiuLiangShujuByStationPort" resultType="tWimMsgVo">
        SELECT CASE a.Direction WHEN 0 THEN '正常行驶'
        ELSE '逆行'
        END as directionName,
        CASE a.Is_Straddle WHEN 0 THEN '否'
        ELSE '是'
        end as isStraddleName,
        CASE a.Lane_No WHEN 1 THEN '超车道'
        WHEN 2 THEN '行车道'
        ELSE '应急车道'
        end as laneNoName,
        CASE WHEN a.Over_Weight_Ratio>0 THEN '超重'
        ELSE '不超重'
        end as overWeightRatioName,
        a.*,b.Station_Name,b.Route_Name,concat_ws("+",b.Station_Name,b.Route_Name) as stationNameRouteName,
        c.License_Plate_Color,d.Vehicle_Type_Name
        from (select a.* from t_vehicle_msg_today a where date(Evt_Time) = curdate() and
        <include refid="StationIP_chaozaishuju_sql"></include>
        ) a
        LEFT JOIN station_site b on a.Station_IP=b.Station_Port
        LEFT JOIN license_plate c ON a.Plate_Color=c.License_Plate_No
        LEFT JOIN vehicle_type d ON a.Class_Index=d.Vehicle_Type_No

    </select>

    <select id="getMeiRiChaoZaiShujuByStationPort" resultType="tWimMsgVo">
        SELECT CASE a.Direction WHEN 0 THEN '正常行驶'
        ELSE '逆行'
        END as directionName,
        CASE a.Is_Straddle WHEN 0 THEN '否'
        ELSE '是'
        end as isStraddleName,
        CASE a.Lane_No WHEN 1 THEN '超车道'
        WHEN 2 THEN '行车道'
        ELSE '应急车道'
        end as laneNoName,
        CASE WHEN a.Over_Weight_Ratio>0 THEN '超重'
        ELSE '不超重'
        end as overWeightRatioName,
        a.*,b.Station_Name,b.Route_Name,concat_ws("+",b.Station_Name,b.Route_Name) as stationNameRouteName,
        c.License_Plate_Color,d.Vehicle_Type_Name
        from (select a.* from t_vehicle_msg_today a where date(Evt_Time) = curdate() and Over_Weight>0 and
        <include refid="StationIP_chaozaishuju_sql"></include>
        ) a
        LEFT JOIN station_site b on a.Station_IP=b.Station_Port
        LEFT JOIN license_plate c ON a.Plate_Color=c.License_Plate_No
        LEFT JOIN vehicle_type d ON a.Class_Index=d.Vehicle_Type_No

    </select>


    <select id="getMeiRiGuanJianChaoZHongShujuByStationPort" resultType="tWimMsgVo">
        SELECT CASE a.Direction WHEN 0 THEN '正常行驶'
        ELSE '逆行'
        END as directionName,
        CASE a.Is_Straddle WHEN 0 THEN '否'
        ELSE '是'
        end as isStraddleName,
        CASE a.Lane_No WHEN 1 THEN '超车道'
        WHEN 2 THEN '行车道'
        ELSE '应急车道'
        end as laneNoName,
        CASE WHEN a.Over_Weight_Ratio>0 THEN '超重'
        ELSE '不超重'
        end as overWeightRatioName,
        a.*,b.Station_Name,b.Route_Name,concat_ws("+",b.Station_Name,b.Route_Name) as stationNameRouteName,
        c.License_Plate_Color,d.Vehicle_Type_Name
        from (select a.* from t_vehicle_msg_today a where date(Evt_Time) = curdate() and Total_Weight>(SELECT
        Crux_Weight FROM crux_weight where Del_State=1 AND lv = #{lv}) and
        <include refid="StationIP_chaozaishuju_sql"></include>
        ) a
        LEFT JOIN station_site b on a.Station_IP=b.Station_Port
        LEFT JOIN license_plate c ON a.Plate_Color=c.License_Plate_No
        LEFT JOIN vehicle_type d ON a.Class_Index=d.Vehicle_Type_No
    </select>

    <select id="gettWimMsgById" resultType="tWimMsgVo">
        select CASE a.Direction WHEN 0 THEN '正常行驶'
        ELSE '逆行'
        END as directionName,
        CASE a.Is_Straddle WHEN 0 THEN '否'
        ELSE '是'
        end as isStraddleName,
         CASE a.Lane_No WHEN 1 THEN '超车道'
        WHEN 2 THEN '行车道'
        ELSE '应急车道'
        end as  laneNoName,
        CASE  WHEN a.Over_Weight_Ratio>0  THEN '超重'
        ELSE '不超重'
        end as overWeightRatioName,
        a.*,b.Station_Name,b.Route_Name,concat_ws("+",b.Station_Name,b.Route_Name) as stationNameRouteName,
        c.License_Plate_Color,d.Vehicle_Type_Name
        from t_vehicle_msg a
        LEFT JOIN station_site b on a.Station_IP=b.Station_Port
        LEFT JOIN license_plate c ON a.Plate_Color=c.License_Plate_No
        LEFT JOIN vehicle_type d ON a.Class_Index=d.Vehicle_Type_No
        where a.id_local=#{idLocal}
    </select>

    <select id="getGuanJianChaoZhongCheLiangEchartsList2" resultType="CheLiuLiangEchartsList">
        SELECT
                 group_concat(aaa.cnt SEPARATOR ',') AS cnt2,
                group_concat(aaa.Station_Port SEPARATOR ',') AS stationPorts,
                group_concat(aaa.Station_Name SEPARATOR ',') AS stationNames,
                group_concat(aaa.cnt2 SEPARATOR ',') AS cnt3
                FROM
                (select aa.cnt ,
        aa.Station_Port ,
        aa.Station_Name ,
        IFNULL(bb.cnt ,0)cnt2
                 from (SELECT
                            *
                        FROM
                    (
                        SELECT
                            COUNT(
                                CASE
                                WHEN a.Station_IP IS NOT NULL THEN
                                    0
                                END
                            ) cnt,
                            b.Station_Port,
                            b.Station_Name
                        FROM
                            t_vehicle_msg_today a
                        RIGHT JOIN station_site b ON a.Station_IP = b.Station_Port
                        AND date(a.Evt_Time) = curdate()
                        AND a.Total_Weight >= (
                            SELECT
                                Crux_Weight
                            FROM
                                crux_weight w
                            WHERE
                                Del_State = 1
                            AND w.lv = #{lv1}

                        )
                        GROUP BY
                            b.Station_Port
                        HAVING
                            FIND_IN_SET(b.Station_Port ,#{stationPorts})
                        ORDER BY
                            cnt

                    ) dd
                ORDER BY
                    dd.cnt) aa LEFT JOIN (SELECT
                    *
                FROM
                    (
                        SELECT
                            COUNT(
                                CASE
                                WHEN a.Station_IP IS NOT NULL THEN
                                    0
                                END
                            ) cnt,
                            b.Station_Port,
                            b.Station_Name
                        FROM
                            t_vehicle_msg_today a
                        RIGHT JOIN station_site b ON a.Station_IP = b.Station_Port
                        AND date(a.Evt_Time) = curdate()
                        AND a.Total_Weight >= (
                            SELECT
                                Crux_Weight
                            FROM
                                crux_weight w
                            WHERE
                                Del_State = 1
                            AND w.lv = #{lv2}

                        )
                        GROUP BY
                            b.Station_Port
                        HAVING
                            FIND_IN_SET(b.Station_Port ,#{stationPorts})
                        ORDER BY
                            cnt

                    ) dd
                ORDER BY
                    dd.cnt) bb on aa.Station_Port = bb.Station_Port ORDER BY aa.cnt desc
                ) aaa

    </select>

    <select id="getJianCeTotal" resultType="HomeData">
        SELECT * from (
        SELECT COUNT(*) totalChaoZai FROM t_vehicle_msg_today a WHERE a.Over_Weight>0 and FIND_IN_SET(a.Station_IP,#{stationPorts}) and  date(a.Evt_Time) = curdate()
        ) aa LEFT JOIN (
        select MAX(a.Total_Weight) maxWeight FROM t_vehicle_msg_today a WHERE  FIND_IN_SET(a.Station_IP,#{stationPorts}) and  date(a.Evt_Time) = curdate()
        )bb on 1= 1
        LEFT JOIN (
        select COUNT(*) totalCheLiu FROM t_vehicle_msg_today a WHERE  FIND_IN_SET(a.Station_IP,#{stationPorts}) and  date(a.Evt_Time) = curdate()
        )cc on 1= 1
        LEFT JOIN (
        select COUNT(*) totalGuanJian FROM t_vehicle_msg_today a WHERE a.Total_Weight >= (SELECT min(Crux_Weight) FROM crux_weight w WHERE Del_State = 1) AND FIND_IN_SET(a.Station_IP,#{stationPorts}) and  date(a.Evt_Time) = curdate()
        )dd on 1= 1
    </select>

    <select id="getJianCeCheLiuLiangEchartsList" resultType="CheLiuLiangEchartsList">
        SELECT
        group_concat(aa.cnt SEPARATOR ',') AS nums,
        group_concat(aa.Station_Port SEPARATOR ',') AS station_ports,
        group_concat(aa.station_name SEPARATOR ',') AS station_names
        FROM
		(
			SELECT * FROM(SELECT
			COUNT(
				CASE
				WHEN a.Station_IP IS NOT NULL THEN
					0
				END
			) cnt,
			b.Station_Port,
			b.Station_Name
			FROM
				t_vehicle_msg_today a
			RIGHT JOIN station_site b ON a.Station_IP = b.Station_Port AND date(a.Evt_Time) = curdate()
			GROUP BY
				b.Station_Port
			HAVING FIND_IN_SET(b.Station_Port,#{stationPorts})
			ORDER BY
				cnt
			)dd ORDER BY dd.cnt DESC
		) aa
    </select>

    <select id="getJianCechaozaiEchartsList" resultType="CheLiuLiangEchartsList">
        SELECT
        group_concat(aa.cnt SEPARATOR ',') AS nums,
        group_concat(aa.Station_Port SEPARATOR ',') AS station_ports,
        group_concat(aa.station_name SEPARATOR ',') AS station_names
        FROM
		(
			SELECT * FROM(SELECT
			COUNT(
				CASE
				WHEN a.Station_IP IS NOT NULL THEN
					0
				END
			) cnt,
			b.Station_Port,
			b.Station_Name
			FROM
				t_vehicle_msg_today a
			RIGHT JOIN station_site b ON a.Station_IP = b.Station_Port AND date(a.Evt_Time) = curdate() and a.Over_Weight>0
			GROUP BY
				b.Station_Port
			HAVING FIND_IN_SET(b.Station_Port,#{stationPorts})
			ORDER BY
				cnt
			)dd ORDER BY dd.cnt DESC
		) aa
    </select>
</mapper>

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ldxx.dao.tWimMsgDao">

    <sql id="StationIP_sql">
        <if test="stationPort!=null and stationPort!=''">
            <if test="stationPort.indexOf(',')!=-1">
                a.Station_IP in
                <foreach collection="stationPort.split(',')" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
            <if test="stationPort.indexOf(',')==-1">
                a.Station_IP=#{stationPort}
            </if>
            ORDER BY a.Evt_Time desc limit 5
        </if>
    </sql>
    <sql id="StationIP_sql_tongji">
        <if test="stationPort!=null and stationPort!=''">
            <if test="stationPort.indexOf(',')!=-1">
                and a.Station_IP in
                <foreach collection="stationPort.split(',')" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
            <if test="stationPort.indexOf(',')==-1">
                and a.Station_IP=#{stationPort}
            </if>
            /*ORDER BY a.Evt_Time desc*/
        </if>
    </sql>
    <sql id="CheXing_IP_sql_tongji">
        <if test="chexing!=null and chexing!=''">
            and FIND_IN_SET(a.Class_Index,#{chexing})
        </if>
    </sql>
    <sql id="StationIP_chaozaishuju_sql">
        <if test="stationPort!=null and stationPort!=''">
            <if test="stationPort.indexOf(',')!=-1">
                a.Station_IP in
                <foreach collection="stationPort.split(',')" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
            <if test="stationPort.indexOf(',')==-1">
                a.Station_IP=#{stationPort}
            </if>
            ORDER BY a.Evt_Time desc
        </if>
    </sql>

    <select id="getAlltWimMsg" resultType="tWimMsgVo">
        select CASE a.Direction WHEN 0 THEN '正常行驶'
        ELSE '逆行'
        END as directionName,
        CASE a.Is_Straddle WHEN 0 THEN '否'
        ELSE '是'
        end as isStraddleName,
        CASE a.Lane_No WHEN 1 THEN '超车道'
        WHEN 2 THEN '行车道'
        ELSE '应急车道'
        end as laneNoName,
        CASE WHEN a.Over_Weight_Ratio>0 THEN '超载'
        ELSE '不超载'
        end as overWeightRatioName,
        a.*,b.Station_Name,b.Route_Name,concat_ws("+",b.Station_Name,b.Route_Name) as stationNameRouteName,
        c.License_Plate_Color,d.Vehicle_Type_Name,IFNULL(e.Overload_Standard,49000) as maxWeight
        from (SELECT a.* from t_vehicle_msg_today a where <include refid="StationIP_sql"></include>) a
        LEFT JOIN station_site b on a.Station_IP=b.Station_Port
        LEFT JOIN license_plate c ON a.Plate_Color=c.License_Plate_No
        LEFT JOIN vehicle_type d ON a.Class_Index=d.Vehicle_Type_No
        LEFT JOIN overload_standard e on a.Axles_Count=e.Axle_Number
    </select>

    <select id="getAlltWimMsgByCondition" fetchSize="-2147483648" resultType="tWimMsgVo">
        SELECT * FROM (SELECT
        CASE aa.Direction
        WHEN 0 THEN
        '正常行驶'
        ELSE
        '逆行'
        END AS directionName,
        CASE aa.Is_Straddle
        WHEN 0 THEN
        '否'
        ELSE
        '是'
        END AS isStraddleName,
        aa.Lane_No as laneNoName,
        CASE WHEN aa.Over_Weight_Ratio>0 THEN aa.Over_Weight_Ratio
        ELSE '不超载'
        end as overWeightRatioName,
        aa.*, b.Station_Name,
        b.Route_Name,
        concat_ws(
        "+",
        b.Station_Name,
        b.Route_Name
        ) AS stationNameRouteName,
        c.License_Plate_Color,
        d.Vehicle_Type_Name,IFNULL(e.Overload_Standard,49000) as maxWeight,
        (Axle_space1+Axle_space2+Axle_space3+Axle_space4+Axle_space5+Axle_space6+Axle_space7+Axle_space8+Axle_space9) as
        axleSpace
        FROM
        (
        SELECT * FROM t_vehicle_msg WHERE id_local in (
        SELECT id_local from (
        select id_local from t_vehicle_msg a
        <where>
            <if test="startTime!=null and startTime!='' ">
                and #{startTime} &lt;= Evt_Time
            </if>
            <if test="endTime!=null and endTime!='' ">
                and Evt_Time &lt;= #{endTime}
            </if>
            <if test="startWeight!=null and startWeight!='' ">
                and #{startWeight} &lt; total_weight
            </if>
            <if test="endWeight!=null and endWeight!='' ">
                and total_weight &lt; #{endWeight}
            </if>

            <if test="chesuStart!=null and chesuStart!='' ">
                and #{chesuStart} &lt; speed
            </if>
            <if test="chesuEnd!=null and chesuEnd!='' ">
                and speed &lt; #{chesuEnd}
            </if>
            <if test="cheChangStart!=null and cheChangStart!='' ">
                and #{cheChangStart} &lt; length
            </if>
            <if test="cheChangEnd!=null and cheChangEnd!='' ">
                and length &lt; #{cheChangEnd}
            </if>

            <if test="roadTmpStart!=null and roadTmpStart!='' ">
                and #{roadTmpStart} &lt; Temperature
            </if>
            <if test="roadTmpEnd!=null and roadTmpEnd!='' ">
                and Temperature &lt; #{roadTmpEnd}
            </if>

            <if test="chaozhongStart !=null and chaozhongStart!=''">
                and Over_Weight_Ratio >0
            </if>
            <if test="chaozhongEnd!=null and chaozhongEnd!='' ">
                and Over_Weight_Ratio &lt; #{chaozhongEnd}
            </if>

            <if test="chepai!=null and chepai!='' ">
                and Plate like CONCAT('%',#{chepai},'%')
            </if>

            <if test="zhoushu!=null and zhoushu!='' ">
                and Axles_Count = #{zhoushu}
            </if>


            <include refid="CheXing_IP_sql_tongji">
            </include>
            <include refid="StationIP_sql_tongji">
            </include>

        </where>
        <if test="columnName !='' and columnName !=null ">
            ORDER BY
            ${columnName}
        </if>
        <if test="columnName =='' or columnName ==null ">
            ORDER BY
            Evt_Time
            DESC
        </if>
        <if test="start !=null">
            LIMIT #{start},
            #{length}
        </if>
        ) an
        )) aa
        LEFT JOIN station_site b ON aa.Station_IP = b.Station_Port
        LEFT JOIN license_plate c ON aa.Plate_Color = c.License_Plate_No
        LEFT JOIN vehicle_type d ON aa.Class_Index = d.Vehicle_Type_No
        LEFT JOIN overload_standard e on aa.Axles_Count=e.Axle_Number)aaa
        <if test="columnName !='' and columnName !=null ">
            ORDER BY
            aaa.${columnName}
        </if>
        <if test="columnName =='' or columnName ==null ">
            ORDER BY
            aaa.Evt_Time
            DESC
        </if>
    </select>
    <select id="getAlltWimMsgYiChangByCondition" fetchSize="-2147483648" resultType="tWimMsgVo">
        SELECT * FROM (SELECT
        CASE aa.Direction
        WHEN 0 THEN
        '正常行驶'
        ELSE
        '逆行'
        END AS directionName,
        CASE aa.Is_Straddle
        WHEN 0 THEN
        '否'
        ELSE
        '是'
        END AS isStraddleName,
        aa.Lane_No as laneNoName,
        CASE WHEN aa.Over_Weight_Ratio>0 THEN aa.Over_Weight_Ratio
        ELSE '不超载'
        end as overWeightRatioName,
        aa.*, b.Station_Name,
        b.Route_Name,
        concat_ws(
        "+",
        b.Station_Name,
        b.Route_Name
        ) AS stationNameRouteName,
        c.License_Plate_Color,
        d.Vehicle_Type_Name,IFNULL(e.Overload_Standard,49000) as maxWeight
        FROM
        (select * from t_vehicle_msg_abnormal a
        <where>
            <if test="startTime!=null and startTime!='' ">
                and #{startTime} &lt;= msg_time
            </if>
            <if test="endTime!=null and endTime!='' ">
                and msg_time &lt;= #{endTime}
            </if>
            <if test="startWeight!=null and startWeight!='' ">
                and #{startWeight} &lt; total_weight
            </if>
            <if test="endWeight!=null and endWeight!='' ">
                and total_weight &lt; #{endWeight}
            </if>

            <if test="chesuStart!=null and chesuStart!='' ">
                and #{chesuStart} &lt; speed
            </if>
            <if test="chesuEnd!=null and chesuEnd!='' ">
                and speed &lt; #{chesuEnd}
            </if>
            <if test="cheChangStart!=null and cheChangStart!='' ">
                and #{cheChangStart} &lt; length
            </if>
            <if test="cheChangEnd!=null and cheChangEnd!='' ">
                and length &lt; #{cheChangEnd}
            </if>

            <if test="roadTmpStart!=null and roadTmpStart!='' ">
                and #{roadTmpStart} &lt; Temperature
            </if>
            <if test="roadTmpEnd!=null and roadTmpEnd!='' ">
                and Temperature &lt; #{roadTmpEnd}
            </if>

            <if test="chaozhongStart !=null and chaozhongStart!=''">
                and Over_Weight_Ratio >0
            </if>
            <if test="chaozhongEnd!=null and chaozhongEnd!='' ">
                and Over_Weight_Ratio &lt; #{chaozhongEnd}
            </if>

            <if test="chepai!=null and chepai!='' ">
                and Plate like CONCAT('%',#{chepai},'%')
            </if>

            <if test="zhoushu!=null and zhoushu!='' ">
                and Axles_Count = #{zhoushu}
            </if>


            <include refid="CheXing_IP_sql_tongji">
            </include>
            <include refid="StationIP_sql_tongji">
            </include>

        </where>
        <if test="columnName !='' and columnName !=null ">
            ORDER BY
            ${columnName}
        </if>
        <if test="columnName =='' or columnName ==null ">
            ORDER BY
            Evt_Time
            DESC
        </if>
        <if test="start !=null">
            LIMIT #{start},
            #{length}
        </if>
        ) aa
        LEFT JOIN station_site b ON aa.Station_IP = b.Station_Port
        LEFT JOIN license_plate c ON aa.Plate_Color = c.License_Plate_No
        LEFT JOIN vehicle_type d ON aa.Class_Index = d.Vehicle_Type_No
        LEFT JOIN overload_standard e on aa.Axles_Count=e.Axle_Number)aaa
        <if test="columnName !='' and columnName !=null ">
            ORDER BY
            aaa.${columnName}
        </if>
        <if test="columnName =='' or columnName ==null ">
            ORDER BY
            aaa.Evt_Time
            DESC
        </if>
    </select>

    <select id="getMeiRiCheLiuLiangByStationPort" resultType="int">
        SELECT COUNT(*) from t_vehicle_msg_today where  Station_IP=#{stationPort} AND date(Evt_Time) = curdate()
    </select>
    <select id="getMeiRiCheLiuLiangMaxByStationPort" resultType="int">
       SELECT IFNULL(max(a.cnt),0) FROM (SELECT COUNT(*) cnt FROM t_vehicle_msg_today WHERE date(Evt_Time) = curdate() GROUP BY Station_IP)a
    </select>

    <select id="getMeiRiChaoZhongByStationPort" resultType="int">
        SELECT COUNT(*) from t_vehicle_overweight where  Station_IP=#{stationPort} AND date(Evt_Time) = curdate() and Over_Weight>0
    </select>



    <select id="getChaoZaiEchartsList" resultType="CheLiuLiangEchartsList">

            SELECT
                    group_concat(aa.cntc SEPARATOR ',') AS nums,
                    group_concat(
                        aa.Station_Port SEPARATOR ','
                    ) AS station_ports,
                    group_concat(
                        aa.station_name SEPARATOR ','
                    ) AS station_names,
                    group_concat(aa.cnta SEPARATOR ',') AS numCount,
                    group_concat(aa.cntt SEPARATOR ',') AS nums2,
                    group_concat(aa.cntc/aa.cnta SEPARATOR ',') AS numsBili
                FROM
                    (
                        SELECT
                            COUNT(
                                CASE
                                WHEN a.Station_IP IS NOT NULL THEN
                                    0
                                END
                            ) cntc,
                            b.Station_Port,
                            b.Station_Name,
                                                cc.cnt as cnta,
                                                (cc.cnt - COUNT(
                                CASE
                                WHEN a.Station_IP IS NOT NULL THEN
                                    0
                                END
                            )) as cntt


                        FROM
                            t_vehicle_msg_today a
                        RIGHT JOIN station_site b ON a.Station_IP = b.Station_Port AND a.Over_Weight>0 AND date(a.Evt_Time) = curdate() and a.Total_Weight &lt;(SELECT Crux_Weight FROM crux_weight  WHERE Del_State = 1 AND lv = 2)
                        <if test="link!=null and link!=''">
                            and b.link = #{link}
                        </if>
                    RIGHT JOIN(
                                    SELECT
                                        COUNT(0) cntc
                                    FROM
                                        t_vehicle_msg_today

                                    WHERE
                                        Over_Weight>0 AND
                                        date(Evt_Time) = curdate() AND
                                        FIND_IN_SET(
                                            Station_IP,
                                            #{stationPorts}
                                        )
                                    ) c on 1=1
                                RIGHT JOIN(SELECT
                                            COUNT(
                                                CASE
                                                WHEN a.Station_IP IS NOT NULL THEN
                                                    0
                                                END
                                            ) cnt,
                                            bb.Station_Port,
                                            bb.Station_Name
                                            FROM
                                                t_vehicle_msg_today a
                                            RIGHT JOIN station_site bb ON a.Station_IP = bb.Station_Port AND date(a.Evt_Time) = curdate()
                                            GROUP BY
                                                bb.Station_Port
                                            HAVING FIND_IN_SET(bb.Station_Port,#{stationPorts})
                                            ORDER BY
                                                cnt DESC,bb.Station_Name) cc on cc.Station_Port = b.Station_Port
                                                GROUP BY
                                                    b.Station_Port
                                                HAVING
                                                    FIND_IN_SET(
                                                        b.Station_Port,
                                                         #{stationPorts}
                                                    )
                                                ORDER BY
                                                    cntc DESC,cc.Station_Name
                                                <if test="limit!=null and limit!=''">
                                                    LIMIT #{limit}
                                                </if>
                                            ) aa
    </select>


    <select id="getCountByTableName" resultType="int">
        SELECT COUNT(*) from t_vehicle_msg a
        <where>
            <if test="startTime!=null and startTime!='' ">
                and #{startTime} &lt;= Evt_Time
            </if>
            <if test="endTime!=null and endTime!='' ">
                and Evt_Time &lt;= #{endTime}
            </if>
            <if test="startWeight!=null and startWeight!='' ">
                and #{startWeight} &lt; total_weight
            </if>
            <if test="endWeight!=null and endWeight!='' ">
                and total_weight &lt; #{endWeight}
            </if>

            <if test="chesuStart!=null and chesuStart!='' ">
                and #{chesuStart} &lt; speed
            </if>
            <if test="chesuEnd!=null and chesuEnd!='' ">
                and speed &lt; #{chesuEnd}
            </if>
            <if test="cheChangStart!=null and cheChangStart!='' ">
                and #{cheChangStart} &lt; length
            </if>
            <if test="cheChangEnd!=null and cheChangEnd!='' ">
                and length &lt; #{cheChangEnd}
            </if>
            <if test="roadTmpStart!=null and roadTmpStart!='' ">
                and #{roadTmpStart} &lt; Temperature
            </if>
            <if test="roadTmpEnd!=null and roadTmpEnd!='' ">
                and Temperature &lt; #{roadTmpEnd}
            </if>

            <if test="chaozhongStart !=null and chaozhongStart!=''">
                and  Over_Weight_Ratio >0
            </if>
            <if test="chaozhongEnd!=null and chaozhongEnd!='' ">
                and Over_Weight_Ratio &lt; #{chaozhongEnd}
            </if>

            <if test="chepai!=null and chepai!='' ">
                and Plate like CONCAT('%',#{chepai},'%')
            </if>

            <if test="zhoushu!=null and zhoushu!='' ">
                and Axles_Count = #{zhoushu}
            </if>


            <include refid="CheXing_IP_sql_tongji">
            </include>
            <include refid="StationIP_sql_tongji">
            </include>

        </where>
    </select>
    <select id="getCountYiChangByTableName" resultType="int">
        SELECT COUNT(*) from t_vehicle_msg_abnormal a
        <where>
            <if test="startTime!=null and startTime!='' ">
                and #{startTime} &lt;= Evt_Time
            </if>
            <if test="endTime!=null and endTime!='' ">
                and Evt_Time &lt;= #{endTime}
            </if>
            <if test="startWeight!=null and startWeight!='' ">
                and #{startWeight} &lt; total_weight
            </if>
            <if test="endWeight!=null and endWeight!='' ">
                and total_weight &lt; #{endWeight}
            </if>

            <if test="chesuStart!=null and chesuStart!='' ">
                and #{chesuStart} &lt; speed
            </if>
            <if test="chesuEnd!=null and chesuEnd!='' ">
                and speed &lt; #{chesuEnd}
            </if>
            <if test="cheChangStart!=null and cheChangStart!='' ">
                and #{cheChangStart} &lt; length
            </if>
            <if test="cheChangEnd!=null and cheChangEnd!='' ">
                and length &lt; #{cheChangEnd}
            </if>
            <if test="roadTmpStart!=null and roadTmpStart!='' ">
                and #{roadTmpStart} &lt; Temperature
            </if>
            <if test="roadTmpEnd!=null and roadTmpEnd!='' ">
                and Temperature &lt; #{roadTmpEnd}
            </if>

            <if test="chaozhongStart !=null and chaozhongStart!=''">
                and  Over_Weight_Ratio >0
            </if>
            <if test="chaozhongEnd!=null and chaozhongEnd!='' ">
                and Over_Weight_Ratio &lt; #{chaozhongEnd}
            </if>

            <if test="chepai!=null and chepai!='' ">
                and Plate like CONCAT('%',#{chepai},'%')
            </if>

            <if test="zhoushu!=null and zhoushu!='' ">
                and Axles_Count = #{zhoushu}
            </if>


            <include refid="CheXing_IP_sql_tongji">
            </include>
            <include refid="StationIP_sql_tongji">
            </include>

        </where>
    </select>

    <select id="getMeiRiGuanJianCheLiangByStationPort" resultType="int">
        SELECT COUNT(*) from t_vehicle_overweight
        where  Station_IP=#{stationPort} AND date(Evt_Time) = curdate() and Total_Weight>(SELECT Crux_Weight FROM crux_weight where Del_State=1)
    </select>


    <select id="getHomeData" resultType="HomeData">
        SELECT * from (
        SELECT COUNT(*) totalChaoZai FROM t_vehicle_overweight a WHERE a.Over_Weight>0 and FIND_IN_SET(a.Station_IP,#{stationPorts}) and  date(a.Evt_Time) = curdate()
        ) aa LEFT JOIN (
        select a.Total_Weight maxWeight,id_local FROM t_vehicle_overweight a  WHERE   date(a.Evt_Time) = curdate() and FIND_IN_SET(a.Station_IP,#{stationPorts}) order by a.Total_Weight desc LIMIT 1
        )bb on 1= 1
        LEFT JOIN (
        select COUNT(*) totalCheLiu FROM t_vehicle_msg_today a WHERE  FIND_IN_SET(a.Station_IP,#{stationPorts}) and  date(a.Evt_Time) = curdate()
        )cc on 1= 1
        LEFT JOIN (
        select group_concat(b.link SEPARATOR ',') AS links FROM station_site b WHERE  FIND_IN_SET(b.Station_Port,#{stationPorts})
        )dd on 1= 1
        LEFT JOIN(
        select group_concat(b.Station_Name SEPARATOR ',') AS stationNames FROM station_site b WHERE  FIND_IN_SET(b.Station_Port,#{stationPorts})
        )ee on 1= 1
    </select>

    <select id="getCheLiuLiangEchartsList" resultType="CheLiuLiangEchartsList">
        SELECT
        group_concat(aa.cnt SEPARATOR ',') AS nums,
        group_concat(aa.Station_Port SEPARATOR ',') AS station_ports,
        group_concat(aa.station_name SEPARATOR ',') AS station_names
        FROM
		(
			SELECT * FROM(SELECT
			COUNT(
				CASE
				WHEN a.Station_IP IS NOT NULL THEN
					0
				END
			) cnt,
			b.Station_Port,
			b.Station_Name
			FROM
				t_vehicle_msg_today a
			RIGHT JOIN station_site b ON a.Station_IP = b.Station_Port AND date(a.Evt_Time) = curdate()
            <if test="link!=null and link!=''">
               and b.link #{link}
            </if>
			GROUP BY
        b.Station_Port
        HAVING FIND_IN_SET(b.Station_Port,#{stationPorts})
        ORDER BY
        cnt DESC,b.Station_Name ASC
        <if test="limit!=null and limit!=''">
            LIMIT #{limit}
        </if>
        )dd ORDER BY dd.cnt
        ) aa
    </select>
    <select id="initLiuZhouChaoZaiShuLiang" resultType="CheLiuLiangEchartsList">
        SELECT
        group_concat(aa.cnt SEPARATOR ',') AS nums,
        group_concat(aa.Station_Port SEPARATOR ',') AS station_ports,
        group_concat(aa.station_name SEPARATOR ',') AS station_names
        FROM
        (
        SELECT * FROM(SELECT
        COUNT(
        CASE
        WHEN a.Station_IP IS NOT NULL THEN
        0
        END
        ) cnt,
        b.Station_Port,
        b.Station_Name
        FROM
        t_vehicle_msg_today a
        RIGHT JOIN station_site b ON a.Station_IP = b.Station_Port AND date(a.Evt_Time) = curdate()
        <if test="link!=null and link!=''">
            and b.link #{link}
        </if>
        WHERE a.axles_count=6
        GROUP BY
        b.Station_Port
        HAVING FIND_IN_SET(b.Station_Port,#{stationPorts})
        ORDER BY
        cnt DESC,b.Station_Name ASC
        <if test="limit!=null and limit!=''">
            LIMIT #{limit}
        </if>
        )dd ORDER BY dd.cnt
        ) aa
    </select>

    <select id="getGuanJianChaoZhongCheLiangEchartsList" resultType="CheLiuLiangEchartsList">
        SELECT
        group_concat(aaa.cnt SEPARATOR ',') AS cnt2,
        group_concat(aaa.Station_Port SEPARATOR ',') AS stationPorts,
        group_concat(aaa.Station_Name SEPARATOR ',') AS stationNames,
        group_concat(aaa.cnt2 SEPARATOR ',') AS cnt3
        FROM
        (select aa.cnt ,
        aa.Station_Port ,
        aa.Station_Name ,
        IFNULL(bb.cnt ,0)cnt2
                 from (SELECT
                            *
                        FROM
                    (
                        SELECT
                            COUNT(
                                CASE
                                WHEN a.Station_IP IS NOT NULL THEN
                                    0
                                END
                            ) cnt,
                            b.Station_Port,
                            b.Station_Name
                        FROM
                            t_vehicle_overweight a
                        RIGHT JOIN station_site b ON a.Station_IP = b.Station_Port
                        AND date(a.Evt_Time) = curdate()
                        <if test="link!=null and link!=''">
                            and b.link #{link}
                        </if>

                        AND
                            a.Total_Weight>=(SELECT Crux_Weight FROM crux_weight w  WHERE  Del_State = 1 AND w.lv = #{lv1} )
                            and a.Total_Weight &lt; (SELECT Crux_Weight FROM crux_weight w  WHERE  Del_State = 1 AND w.lv = #{lv2} )
                        GROUP BY
                            b.Station_Port
                        HAVING
                            FIND_IN_SET(b.Station_Port ,#{stationPorts})
                        ORDER BY
                            cnt DESC ,b.Station_Name ASC
                    ) dd
                ORDER BY
                    dd.cnt DESC) aa LEFT JOIN (SELECT
                    *
                FROM
                    (
                        SELECT
                            COUNT(
                                CASE
                                WHEN a.Station_IP IS NOT NULL THEN
                                    0
                                END
                            ) cnt,
                            b.Station_Port,
                            b.Station_Name
                        FROM
                            t_vehicle_overweight a
                        RIGHT JOIN station_site b ON a.Station_IP = b.Station_Port
                        AND date(a.Evt_Time) = curdate()
                        AND a.Total_Weight >= (
                            SELECT
                                Crux_Weight
                            FROM
                                crux_weight w
                            WHERE
                                Del_State = 1
                            AND w.lv = #{lv2}

                        )
                        GROUP BY
                            b.Station_Port
                        HAVING
                            FIND_IN_SET(b.Station_Port ,#{stationPorts})
                        ORDER BY
                            cnt DESC,b.Station_Name ASC
                        LIMIT 6
                    ) dd
                ORDER BY
                    dd.cnt DESC) bb on aa.Station_Port = bb.Station_Port ORDER BY aa.cnt DESC,bb.cnt DESC,bb.Station_Name ASC LIMIT 6
                ) aaa

    </select>


    <select id="getMeiRiGuanJianCheLiangMax" resultType="int">
        SELECT  IFNULL(max(a.cnt),0) FROM (SELECT COUNT(*) cnt from t_vehicle_overweight
        where   date(Evt_Time) = curdate() and Total_Weight>(SELECT Crux_Weight FROM crux_weight where Del_State=1) GROUP BY Station_IP)a
    </select>

    <select id="getMeiRiCheLiuLiangShujuByStationPort" resultType="tWimMsgVo">
        SELECT CASE a.Direction WHEN 0 THEN '正常行驶'
        ELSE '逆行'
        END as directionName,
        CASE a.Is_Straddle WHEN 0 THEN '否'
        ELSE '是'
        end as isStraddleName,
        CASE a.Lane_No WHEN 1 THEN '超车道'
        WHEN 2 THEN '行车道'
        ELSE '应急车道'
        end as laneNoName,
        CASE WHEN a.Over_Weight_Ratio>0 THEN '超载'
        ELSE '不超载'
        end as overWeightRatioName,
        a.*,b.Station_Name,b.Route_Name,concat_ws("+",b.Station_Name,b.Route_Name) as stationNameRouteName,
        c.License_Plate_Color,d.Vehicle_Type_Name,IFNULL(e.Overload_Standard,49000) as maxWeight
        from (select a.* from t_vehicle_msg_today a where date(Evt_Time) = curdate() and
        <include refid="StationIP_chaozaishuju_sql"></include>
        ) a
        LEFT JOIN station_site b on a.Station_IP=b.Station_Port
        LEFT JOIN license_plate c ON a.Plate_Color=c.License_Plate_No
        LEFT JOIN vehicle_type d ON a.Class_Index=d.Vehicle_Type_No
        LEFT JOIN overload_standard e on a.Axles_Count=e.Axle_Number
    </select>

    <select id="getMeiRiChaoZaiShujuByStationPort" resultType="tWimMsgVo">
        SELECT CASE a.Direction WHEN 0 THEN '正常行驶'
        ELSE '逆行'
        END as directionName,
        CASE a.Is_Straddle WHEN 0 THEN '否'
        ELSE '是'
        end as isStraddleName,
        CASE a.Lane_No WHEN 1 THEN '超车道'
        WHEN 2 THEN '行车道'
        ELSE '应急车道'
        end as laneNoName,
        CASE WHEN a.Over_Weight_Ratio>0 THEN '超载'
        ELSE '不超载'
        end as overWeightRatioName,
        a.*,b.Station_Name,b.Route_Name,concat_ws("+",b.Station_Name,b.Route_Name) as stationNameRouteName,
        c.License_Plate_Color,d.Vehicle_Type_Name,IFNULL(e.Overload_Standard,49000) as maxWeight
        from (select a.* from t_vehicle_msg_today a where date(Evt_Time) = curdate() and Over_Weight>0 and  a.Total_Weight &lt;(SELECT Crux_Weight FROM crux_weight  WHERE Del_State = 1 AND lv = 2) and
        <include refid="StationIP_chaozaishuju_sql"></include>
        ) a
        LEFT JOIN station_site b on a.Station_IP=b.Station_Port
        LEFT JOIN license_plate c ON a.Plate_Color=c.License_Plate_No
        LEFT JOIN vehicle_type d ON a.Class_Index=d.Vehicle_Type_No
        LEFT JOIN overload_standard e on a.Axles_Count=e.Axle_Number
    </select>


    <select id="getMeiRiGuanJianChaoZHongShujuByStationPort" resultType="tWimMsgVo">
        SELECT CASE a.Direction WHEN 0 THEN '正常行驶'
        ELSE '逆行'
        END as directionName,
        CASE a.Is_Straddle WHEN 0 THEN '否'
        ELSE '是'
        end as isStraddleName,
        CASE a.Lane_No WHEN 1 THEN '超车道'
        WHEN 2 THEN '行车道'
        ELSE '应急车道'
        end as laneNoName,
        CASE WHEN a.Over_Weight_Ratio>0 THEN '超载'
        ELSE '不超载'
        end as overWeightRatioName,
        a.*,b.Station_Name,b.Route_Name,concat_ws("+",b.Station_Name,b.Route_Name) as stationNameRouteName,
        c.License_Plate_Color,d.Vehicle_Type_Name,IFNULL(e.Overload_Standard,49000) as maxWeight
        from (select a.* from t_vehicle_overweight a
        where date(Evt_Time) = curdate() and
        <if test="lv==2">
            Total_Weight>=(SELECT Crux_Weight FROM crux_weight where Del_State=1 AND lv = #{lv})and
            Total_Weight &lt;(SELECT Crux_Weight FROM crux_weight where Del_State=1 AND lv = 3) and
        </if>
        <if test="lv==3">
            Total_Weight >=(SELECT Crux_Weight FROM crux_weight where Del_State=1 AND lv = #{lv}) and
        </if>
        <include refid="StationIP_chaozaishuju_sql"></include>
        ) a
        LEFT JOIN station_site b on a.Station_IP=b.Station_Port
        LEFT JOIN license_plate c ON a.Plate_Color=c.License_Plate_No
        LEFT JOIN vehicle_type d ON a.Class_Index=d.Vehicle_Type_No
        LEFT JOIN overload_standard e on a.Axles_Count=e.Axle_Number
    </select>

    <select id="gettWimMsgById" resultType="tWimMsgVo">
        select CASE a.Direction WHEN 0 THEN '正常行驶'
        ELSE '逆行'
        END as directionName,
        CASE a.Is_Straddle WHEN 0 THEN '否'
        ELSE '是'
        end as isStraddleName,
         CASE a.Lane_No WHEN 1 THEN '超车道'
        WHEN 2 THEN '行车道'
        ELSE '应急车道'
        end as  laneNoName,
        CASE  WHEN a.Over_Weight_Ratio>0  THEN '超载'
        ELSE '不超载'
        end as overWeightRatioName,
        a.*,b.Station_Name,b.Route_Name,concat_ws("+",b.Station_Name,b.Route_Name) as stationNameRouteName,
        c.License_Plate_Color,d.Vehicle_Type_Name
        from t_vehicle_msg a
        LEFT JOIN station_site b on a.Station_IP=b.Station_Port
        LEFT JOIN license_plate c ON a.Plate_Color=c.License_Plate_No
        LEFT JOIN vehicle_type d ON a.Class_Index=d.Vehicle_Type_No
        where a.id_local=#{idLocal}
    </select>
    <select id="gettWimMsgYiChangById" resultType="tWimMsgVo">
        select CASE a.Direction WHEN 0 THEN '正常行驶'
        ELSE '逆行'
        END as directionName,
        CASE a.Is_Straddle WHEN 0 THEN '否'
        ELSE '是'
        end as isStraddleName,
         CASE a.Lane_No WHEN 1 THEN '超车道'
        WHEN 2 THEN '行车道'
        ELSE '应急车道'
        end as  laneNoName,
        CASE  WHEN a.Over_Weight_Ratio>0  THEN '超载'
        ELSE '不超载'
        end as overWeightRatioName,
        a.*,b.Station_Name,b.Route_Name,concat_ws("+",b.Station_Name,b.Route_Name) as stationNameRouteName,
        c.License_Plate_Color,d.Vehicle_Type_Name
        from t_vehicle_msg_abnormal a
        LEFT JOIN station_site b on a.Station_IP=b.Station_Port
        LEFT JOIN license_plate c ON a.Plate_Color=c.License_Plate_No
        LEFT JOIN vehicle_type d ON a.Class_Index=d.Vehicle_Type_No
        where a.id_local like CONCAT(#{idLocal},'%')
    </select>

    <select id="getGuanJianChaoZhongCheLiangEchartsList2" resultType="CheLiuLiangEchartsList">
        SELECT
                 group_concat(aaa.cnt SEPARATOR ',') AS cnt2,
                group_concat(aaa.Station_Port SEPARATOR ',') AS stationPorts,
                group_concat(aaa.Station_Name SEPARATOR ',') AS stationNames,
                group_concat(aaa.cnt2 SEPARATOR ',') AS cnt3
                FROM
                (select aa.cnt ,
        aa.Station_Port ,
        aa.Station_Name ,
        IFNULL(bb.cnt ,0)cnt2
                 from (SELECT
                            *
                        FROM
                    (
                        SELECT
                            COUNT(
                                CASE
                                WHEN a.Station_IP IS NOT NULL THEN
                                    0
                                END
                            ) cnt,
                            b.Station_Port,
                            b.Station_Name
                        FROM
                            t_vehicle_overweight a
                        RIGHT JOIN station_site b ON a.Station_IP = b.Station_Port
                        AND date(a.Evt_Time) = curdate()
                        AND
                             a.Total_Weight>=(SELECT Crux_Weight FROM crux_weight w  WHERE  Del_State = 1 AND w.lv = #{lv1} )
                         and a.Total_Weight&lt;(SELECT Crux_Weight FROM crux_weight w  WHERE  Del_State = 1 AND w.lv = #{lv2} )
                        GROUP BY
                            b.Station_Port
                        HAVING
                            FIND_IN_SET(b.Station_Port ,#{stationPorts})
                        ORDER BY
                            cnt desc,b.Station_Name ASC

                    ) dd
                ORDER BY
                    dd.cnt) aa LEFT JOIN (SELECT
                    *
                FROM
                    (
                        SELECT
                            COUNT(
                                CASE
                                WHEN a.Station_IP IS NOT NULL THEN
                                    0
                                END
                            ) cnt,
                            b.Station_Port,
                            b.Station_Name
                        FROM
                            t_vehicle_overweight a
                        RIGHT JOIN station_site b ON a.Station_IP = b.Station_Port
                        AND date(a.Evt_Time) = curdate()
                        AND a.Total_Weight >= (
                            SELECT
                                Crux_Weight
                            FROM
                                crux_weight w
                            WHERE
                                Del_State = 1
                            AND w.lv = #{lv2}

                        )
                        GROUP BY
                            b.Station_Port
                        HAVING
                            FIND_IN_SET(b.Station_Port ,#{stationPorts})
                        ORDER BY
                            cnt desc ,b.Station_Name ASC

                    ) dd
                ORDER BY
                    dd.cnt) bb on aa.Station_Port = bb.Station_Port ORDER BY aa.cnt desc
                ) aaa

    </select>

    <select id="getJianCeTotal" resultType="HomeData">
        SELECT * from (
        SELECT COUNT(*) totalChaoZai FROM t_vehicle_msg_today a WHERE a.Over_Weight>0 and FIND_IN_SET(a.Station_IP,#{stationPorts}) and  date(a.Evt_Time) = curdate() and a.Total_Weight &lt;(SELECT Crux_Weight FROM crux_weight  WHERE Del_State = 1 AND lv = 2)
        ) aa LEFT JOIN (
        SELECT id_local,Total_Weight maxWeight FROM t_vehicle_overweight WHERE Total_Weight = (select MAX(a.Total_Weight) maxWeight FROM t_vehicle_overweight a  WHERE   date(a.Evt_Time) = curdate()) LIMIT 1
        )bb on 1= 1
        LEFT JOIN (
        select COUNT(*) totalCheLiu FROM t_vehicle_msg_today a WHERE  FIND_IN_SET(a.Station_IP,#{stationPorts}) and  date(a.Evt_Time) = curdate()
        )cc on 1= 1
         LEFT JOIN (
        select group_concat(b.link SEPARATOR ',') AS links FROM station_site b WHERE  FIND_IN_SET(b.Station_Port,#{stationPorts})
        )dd on 1= 1
        LEFT JOIN (
        select COUNT(*) totalGuanJian FROM t_vehicle_overweight a WHERE a.Total_Weight >= (SELECT min(Crux_Weight) FROM crux_weight w WHERE Del_State = 1) AND FIND_IN_SET(a.Station_IP,#{stationPorts}) and  date(a.Evt_Time) = curdate()
        )ee on 1= 1
    </select>

    <select id="getJianCeCheLiuLiangEchartsList" resultType="CheLiuLiangEchartsList">
        SELECT
        group_concat(aa.cnt SEPARATOR ',') AS nums,
        group_concat(aa.Station_Port SEPARATOR ',') AS station_ports,
        group_concat(aa.station_name SEPARATOR ',') AS station_names
        FROM
		(
			SELECT * FROM(SELECT
			COUNT(
				CASE
				WHEN a.Station_IP IS NOT NULL THEN
					0
				END
			) cnt,
			b.Station_Port,
			b.Station_Name
			FROM
				t_vehicle_msg_today a
			RIGHT JOIN station_site b ON a.Station_IP = b.Station_Port AND date(a.Evt_Time) = curdate()
			GROUP BY
				b.Station_Port
			HAVING FIND_IN_SET(b.Station_Port,#{stationPorts})
			ORDER BY
				cnt desc,b.Station_Name ASC
			)dd ORDER BY dd.cnt DESC
		) aa
    </select>

    <select id="getJianCechaozaiEchartsList" resultType="CheLiuLiangEchartsList">
        SELECT
        group_concat(aa.cnt SEPARATOR ',') AS nums,
        group_concat(aa.Station_Port SEPARATOR ',') AS station_ports,
        group_concat(aa.station_name SEPARATOR ',') AS station_names
        FROM
		(
			SELECT * FROM(SELECT
			COUNT(
				CASE
				WHEN a.Station_IP IS NOT NULL THEN
					0
				END
			) cnt,
			b.Station_Port,
			b.Station_Name
			FROM
				t_vehicle_msg_today a
			RIGHT JOIN station_site b ON a.Station_IP = b.Station_Port AND date(a.Evt_Time) = curdate() and a.Over_Weight>0 and a.Total_Weight &lt;(SELECT Crux_Weight FROM crux_weight  WHERE Del_State = 1 AND lv = 2)
			GROUP BY
				b.Station_Port
			HAVING FIND_IN_SET(b.Station_Port,#{stationPorts})
			ORDER BY
				cnt desc,b.Station_Name ASC
			)dd ORDER BY dd.cnt DESC
		) aa
    </select>

    <resultMap type="java.util.Map" id="imgResultMap" >
        <result property="liuliangCount" column="liuliangCount" jdbcType="BLOB" typeHandler="com.ldxx.util.MyBlobTypeHandler"/>
        <result property="ChaoZaiCount" column="ChaoZaiCount" jdbcType="BLOB" typeHandler="com.ldxx.util.MyBlobTypeHandler"/>
        <result property="GuanJianCount" column="GuanJianCount" jdbcType="BLOB" typeHandler="com.ldxx.util.MyBlobTypeHandler"/>
    </resultMap>
    <select id="getSecHomeTotal" resultMap="imgResultMap">
        SELECT
        GROUP_CONCAT(aa.liuliangCount SEPARATOR ',') liuliangCount,
        bb.ChaoZaiCount ,cc.GuanJianCount
        FROM
        (
        SELECT concat_ws("-",a.axles_count,count(*)) as liuliangCount
            FROM t_vehicle_msg_today a
            WHERE FIND_IN_SET(a.axles_count,#{axlesCount}) AND FIND_IN_SET(a.Station_IP,#{stationPorts})
            AND date(a.Evt_Time) = curdate() GROUP BY a.axles_count
        ) aa

        LEFT JOIN (SELECT GROUP_CONCAT(aa.ChaoZaiCount SEPARATOR ',') ChaoZaiCount from (
            SELECT concat_ws("-",a.axles_count,count(*)) ChaoZaiCount FROM t_vehicle_msg_today a
            WHERE FIND_IN_SET(a.axles_count,#{axlesCount}) and a.Over_Weight>0 and a.Total_Weight &lt;(SELECT Crux_Weight FROM crux_weight  WHERE Del_State = 1 AND lv = 2)
            and FIND_IN_SET(a.Station_IP,#{stationPorts}) and  date(a.Evt_Time) = curdate() GROUP BY a.axles_count
        )aa
        ) bb on 1=1

        LEFT JOIN (SELECT GROUP_CONCAT(aa.GuanJianCount SEPARATOR ',') GuanJianCount from(
            select concat_ws("-",a.axles_count,count(*)) as GuanJianCount FROM t_vehicle_overweight a
            WHERE FIND_IN_SET(a.axles_count,#{axlesCount}) and a.Total_Weight >= (SELECT min(Crux_Weight) FROM crux_weight w WHERE Del_State = 1)
            AND FIND_IN_SET(a.Station_IP,#{stationPorts}) and  date(a.Evt_Time) = curdate() GROUP BY a.axles_count
        )aa
        )cc on 1= 1


    </select>

    <select id="getSecLiuLiangEcharsList" resultType="SecHomeData">
        SELECT group_concat(aa.liuLiangCount SEPARATOR ',') as liuLiangCount,group_concat(aa.Station_Name SEPARATOR ',') as stationNames from (
        select COUNT(*) liuLiangCount,b.Station_Name from t_vehicle_msg_today a
        LEFT JOIN station_site b ON a.Station_IP = b.Station_Port
        and a.axles_count=#{axlesCount} and date(a.Evt_Time) = curdate() GROUP BY
        b.Station_Port
        HAVING FIND_IN_SET(b.Station_Port,#{stationPorts})
        ORDER BY liuLiangCount desc
        <if test="limit!=null and limit!=''">
            LIMIT #{limit}
        </if>
        ) aa
    </select>

    <select id="getDanZhouChaoZai" resultType="danZhouChaoZai">
SELECT
	count(maxAxle) maxAxle,left(a.Evt_Time,13) Evt_Time
FROM
	(
		SELECT

			GREATEST(
				tvmt.Axle1,
				tvmt.Axle2,
				tvmt.Axle3,
				tvmt.Axle4,
				tvmt.Axle5,
				tvmt.Axle6,
				tvmt.Axle7,
				tvmt.Axle8,
				tvmt.Axle9,
				tvmt.Axle10
			)
maxAxle,
		Evt_Time
	FROM
		t_vehicle_msg_today tvmt
		WHERE FIND_IN_SET(Station_IP,#{stationPorts})
  having  maxAxle>14000
	ORDER BY
		Evt_Time DESC
	)a group by left(a.Evt_Time,13)
    </select>


    <select id="getSecChaoZaiEcharsList" resultType="SecHomeData">
        <!--SELECT group_concat(aa.chaoZaicCount SEPARATOR ',') as chaoZaicCount ,group_concat(aa.Station_Name SEPARATOR ',') as stationNames from (
            select COUNT(*) chaoZaicCount,b.Station_Name  from t_vehicle_msg_today a
            LEFT JOIN station_site b ON a.Station_IP = b.Station_Port
            and  a.axles_count=#{axlesCount} and a.Over_Weight>0  and a.Total_Weight &lt;(SELECT Crux_Weight FROM crux_weight  WHERE Del_State = 1 AND lv = 2)
            and  date(a.Evt_Time) = curdate() GROUP BY b.Station_Port
            HAVING FIND_IN_SET(b.Station_Port,#{stationPorts})
            ORDER BY chaoZaicCount desc
            <if test="limit!=null and limit!=''">
                LIMIT #{limit}
            </if>
        ) aa-->
        <!--SELECT group_concat(aa.chaoZaicCount SEPARATOR ',') as chaoZaicCount ,group_concat(aa.Station_Name SEPARATOR ',') as stationNames ,
        group_concat(aa.chaoZaiBili SEPARATOR ',') as chaoZaiBili
        from (
            select *,(a.chaoZaicCount/b.liuLiangCount) as chaoZaiBili from (  select COUNT(*) chaoZaicCount,b.Station_Name  from t_vehicle_msg_today a
                LEFT JOIN station_site b ON a.Station_IP = b.Station_Port
                and  a.axles_count=#{axlesCount} and a.Over_Weight>0  and a.Total_Weight &lt;(SELECT Crux_Weight FROM crux_weight  WHERE Del_State = 1 AND lv = 2)
                and  date(a.Evt_Time) = curdate() GROUP BY b.Station_Port
                HAVING FIND_IN_SET(b.Station_Port,#{stationPorts})
                ORDER BY chaoZaicCount desc
            ) a
            left join (
                select COUNT(*) liuLiangCount,b.Station_Name  as StationName2 from t_vehicle_msg_today a
                LEFT JOIN station_site b ON a.Station_IP = b.Station_Port
                and  a.axles_count=#{axlesCount} and  date(a.Evt_Time) = curdate() GROUP BY
                b.Station_Port
                HAVING FIND_IN_SET(b.Station_Port,#{stationPorts})
                ORDER BY liuLiangCount desc
            ) b  on a.Station_Name=b.StationName2 ORDER BY a.chaoZaicCount desc,a.Station_Name asc
            <if test="limit!=null and limit!=''">
                LIMIT #{limit}
            </if>
        ) aa-->
        SELECT group_concat(aa.chaoZaicCount SEPARATOR ',') as chaoZaicCount ,group_concat(aa.province_station SEPARATOR ',') as sjName ,
        group_concat(aa.chaoZaiBili SEPARATOR ',') as chaoZaiBili
        from (
            select a.chaoZaicCount,b.liuLiangCount,(a.chaoZaicCount/b.liuLiangCount) as chaoZaiBili,a.province_station from (
                select sum(chaoZaicCount)	as chaoZaicCount,province_station from (
                    select COUNT(*) chaoZaicCount,b.Station_Name,b.province_station  from t_vehicle_msg_today a
                    LEFT JOIN station_site b ON a.Station_IP = b.Station_Port
                    and  a.axles_count=#{axlesCount} and a.Over_Weight>0  and a.Total_Weight &lt;(SELECT Crux_Weight FROM crux_weight  WHERE Del_State = 1 AND lv = 2)
                    and  date(a.Evt_Time) = curdate() GROUP BY b.Station_Port
                    HAVING FIND_IN_SET(b.Station_Port,#{stationPorts})
                    ORDER BY chaoZaicCount desc
                )  a GROUP BY a.province_station ORDER BY  chaoZaicCount desc
            ) a
            left join (
                select sum(liuLiangCount)	as 	liuLiangCount,province_station from (
                    select COUNT(*) liuLiangCount,b.Station_Name  as StationName2,b.province_station from t_vehicle_msg_today a
                    LEFT JOIN station_site b ON a.Station_IP = b.Station_Port
                    and  a.axles_count=#{axlesCount} and  date(a.Evt_Time) = curdate() GROUP BY
                    b.Station_Port
                    HAVING FIND_IN_SET(b.Station_Port,#{stationPorts})
                    ORDER BY liuLiangCount desc
                ) b GROUP BY b.province_station ORDER BY  liuLiangCount desc
            ) b  on a.province_station=b.province_station ORDER BY a.chaoZaicCount desc,a.province_station asc

            <if test="limit!=null and limit!=''">
                LIMIT #{limit}
            </if>

        ) aa
    </select>

    <select id="getSecChaoZaiEcharsListMonth" resultType="SecHomeData">
        <!--select GROUP_CONCAT(a.chaoZai2CountMonth SEPARATOR ',') chaoZai2CountMonth,GROUP_CONCAT(a.chaoZai3CountMonth SEPARATOR ',') chaoZai3CountMonth,
        GROUP_CONCAT(a.chaoZai4CountMonth SEPARATOR ',') chaoZai4CountMonth,GROUP_CONCAT(a.chaoZai5CountMonth SEPARATOR ',') chaoZai5CountMonth,
        GROUP_CONCAT(a.chaoZai6CountMonth SEPARATOR ',') chaoZai6CountMonth,GROUP_CONCAT(a.Station_IP SEPARATOR ',') stationPort,
        GROUP_CONCAT(a.Station_Name SEPARATOR ',') stationNames
        from (
            select (IFNULL(num2,0)+IFNULL(chaozaiNum,0)) as chaoZai2CountMonth,(IFNULL(num3,0)+IFNULL(chaozaiNum,0)) as chaoZai3CountMonth,
            (IFNULL(num4,0)+IFNULL(chaozaiNum,0)) as chaoZai4CountMonth,(IFNULL(num5,0)+IFNULL(chaozaiNum,0)) as chaoZai5CountMonth,
            (IFNULL(num6,0)+IFNULL(chaozaiNum,0)) as chaoZai6CountMonth,a.Station_IP,a.Station_Name
            from (
                SELECT
                Avg_Overload_Count_2 as num2,Avg_Overload_Count_3 as num3,Avg_Overload_Count_4 as num4,
                Avg_Overload_Count_5 as num5,Avg_Overload_Count_6 as num6,a.Station_IP,b.Station_Name
                FROM
                t_avg_month a
                left join station_site b ON b.Station_Port=a.Station_IP
                WHERE
                a.Avg_Time = #{yearMonth}
                AND FIND_IN_SET(a.Station_IP, #{stationPorts})
                AND a.Avg_LaneNo='0'
            ) a
            left join (
                select IFNULL(COUNT(*),0) chaozaiNum,b.Station_Name,a.Station_IP from t_vehicle_msg_today a
        LEFT JOIN station_site b ON a.Station_IP = b.Station_Port
        and a.axles_count=#{axlesCount} and a.Over_Weight>0 and a.Total_Weight &lt;(SELECT Crux_Weight FROM crux_weight
        WHERE Del_State = 1 AND lv = 2)
        and date(a.Evt_Time) = curdate()
        GROUP BY b.Station_Port
        HAVING FIND_IN_SET(b.Station_Port,#{stationPorts})
        ORDER BY chaozaiNum desc
        ) b on a.Station_ip=b.Station_IP
        <include refid="limitSql"></include>
        ) a-->
        select GROUP_CONCAT(a.chaoZai2CountMonth SEPARATOR ',') chaoZai2CountMonth,GROUP_CONCAT(a.chaoZai3CountMonth SEPARATOR ',') chaoZai3CountMonth,
        GROUP_CONCAT(a.chaoZai4CountMonth SEPARATOR ',') chaoZai4CountMonth,GROUP_CONCAT(a.chaoZai5CountMonth SEPARATOR ',') chaoZai5CountMonth,
        GROUP_CONCAT(a.chaoZai6CountMonth SEPARATOR ',') chaoZai6CountMonth,GROUP_CONCAT(a.province_station SEPARATOR ',') sjName
        from (
        select (IFNULL(num2,0)+IFNULL(chaozaiNum,0)) as chaoZai2CountMonth,(IFNULL(num3,0)+IFNULL(chaozaiNum,0)) as chaoZai3CountMonth,
        (IFNULL(num4,0)+IFNULL(chaozaiNum,0)) as chaoZai4CountMonth,(IFNULL(num5,0)+IFNULL(chaozaiNum,0)) as chaoZai5CountMonth,
        (IFNULL(num6,0)+IFNULL(chaozaiNum,0)) as chaoZai6CountMonth,a.province_station
        from (
            select IFNULL(sum(num2),0) num2,IFNULL(sum(num3),0) num3,IFNULL(sum(num4),0) num4,IFNULL(sum(num5),0) num5,
            IFNULL(sum(num6),0) num6,province_station from (
                SELECT
                Avg_Overload_Count_2 as num2,Avg_Overload_Count_3 as num3,Avg_Overload_Count_4 as num4,
                Avg_Overload_Count_5 as num5,Avg_Overload_Count_6 as num6,a.Station_IP,b.Station_Name,b.province_station
                FROM
                t_avg_month a
                left join station_site b ON b.Station_Port=a.Station_IP
                WHERE
                a.Avg_Time = #{yearMonth}
                AND FIND_IN_SET(a.Station_IP,#{stationPorts})
                AND a.Avg_LaneNo='0'
                ) a GROUP BY a.province_station
            ) a
            left join (
                select sum(chaozaiNum) chaozaiNum,province_station from (
                select IFNULL(COUNT(*),0) chaozaiNum,b.Station_Name,a.Station_IP,b.province_station from t_vehicle_msg_today a
                LEFT JOIN station_site b ON a.Station_IP = b.Station_Port
                and a.axles_count=#{axlesCount} and a.Over_Weight>0 and a.Total_Weight &lt;(SELECT Crux_Weight FROM crux_weight
                WHERE Del_State = 1 AND lv = 2)
                and date(a.Evt_Time) = curdate()
                GROUP BY b.Station_Port
                HAVING FIND_IN_SET(b.Station_Port,#{stationPorts})
                ORDER BY chaozaiNum desc
                ) b GROUP BY b.province_station
            ) b on a.province_station=b.province_station
            <include refid="limitSql"></include>
        ) a

    </select>

    <select id="getSecChaoZaiEcharsListByZhanDian" resultType="SecHomeData">

    SELECT group_concat(aa.chaoZaicCount SEPARATOR ',') as chaoZaicCount ,group_concat(aa.Station_Name SEPARATOR ',') as stationNames ,
    group_concat(aa.chaoZaiBili SEPARATOR ',') as chaoZaiBili
    from (
        select *,(a.chaoZaicCount/b.liuLiangCount) as chaoZaiBili from (  select COUNT(*) chaoZaicCount,b.Station_Name  from t_vehicle_msg_today a
            LEFT JOIN station_site b ON a.Station_IP = b.Station_Port
            and  a.axles_count=#{axlesCount} and a.Over_Weight>0  and a.Total_Weight &lt;(SELECT Crux_Weight FROM crux_weight  WHERE Del_State = 1 AND lv = 2)
            and  date(a.Evt_Time) = curdate() GROUP BY b.Station_Port
            HAVING FIND_IN_SET(b.Station_Port,#{stationPorts})
            ORDER BY chaoZaicCount desc
        ) a
        left join (
            select COUNT(*) liuLiangCount,b.Station_Name  as StationName2 from t_vehicle_msg_today a
            LEFT JOIN station_site b ON a.Station_IP = b.Station_Port
            and  a.axles_count=#{axlesCount} and  date(a.Evt_Time) = curdate() GROUP BY
            b.Station_Port
            HAVING FIND_IN_SET(b.Station_Port,#{stationPorts})
            ORDER BY liuLiangCount desc
        ) b  on a.Station_Name=b.StationName2 ORDER BY a.chaoZaicCount desc,a.Station_Name asc
        <if test="limit!=null and limit!=''">
            LIMIT #{limit}
        </if>
    ) aa
    </select>


    <select id="getGongSiTongJiYuJingData" resultType="map">
        SELECT
            GROUP_CONCAT(ta.yi) AS yiJi,
            GROUP_CONCAT(ta.er) AS erJi,
            GROUP_CONCAT(ta.cm) AS company
        FROM
            (
                SELECT
                    tb.yiJi yi,
                    tb.erJi er,
                    tb.company cm
                FROM
                    (
                        SELECT
                            tvmt.*, ss.company,
                            COUNT(1) AS yiJi,
                            aa.erJi
                        FROM
                            t_vehicle_msg_today tvmt
                        LEFT JOIN station_site ss ON tvmt.Station_IP = ss.Station_Port
                        LEFT JOIN (
                            SELECT
                                tvmt.Station_IP,
                                case when COUNT(1) is null then 0 else count(1) end AS erJi
                            FROM
                                t_vehicle_msg_today tvmt
                            LEFT JOIN station_site ss ON tvmt.Station_IP = ss.Station_Port
        WHERE
        tvmt.Total_Weight > 100000 and FIND_IN_SET(tvmt.Station_IP,#{stationPorts})
        GROUP BY
        company
        ORDER BY
        Total_Weight limit #{limit}
        ) aa ON aa.Station_IP = ss.Station_Ip
        WHERE
        tvmt.Total_Weight BETWEEN 49000
        AND 100000 and FIND_IN_SET(tvmt.Station_IP,#{stationPorts})
        <if test="axlesCount!=null and axlesCount!=''">
            and tvmt.Axles_Count=#{axlesCount}
        </if>
        GROUP BY
        company
        ORDER BY
        yiJi desc,company asc limit #{limit}
        ) tb
        ORDER BY
        tb.yiJi DESC
        ) ta
    </select>

    <select id="initShengJieTongJiYuJingData" resultType="map">
        SELECT
            GROUP_CONCAT(ta.yi) AS yiJi,
            GROUP_CONCAT(ta.er) AS erJi,
            GROUP_CONCAT(ta.cm) AS provinceStation
        FROM
            (
                SELECT
                    tb.yiJi yi,
                    tb.erJi er,
                    tb.province_station cm
                FROM
                    (
                        SELECT
                            tvmt.*, ss.province_station,
                            COUNT(1) AS yiJi,
                            aa.erJi
                        FROM
                            t_vehicle_msg_today tvmt
                        LEFT JOIN station_site ss ON tvmt.Station_IP = ss.Station_Port
                        LEFT JOIN (
                            SELECT
                                tvmt.Station_IP,
                                case when COUNT(1) is null then 0 else count(1) end AS erJi
                            FROM
                                t_vehicle_msg_today tvmt
                            LEFT JOIN station_site ss ON tvmt.Station_IP = ss.Station_Port
                            WHERE
                                tvmt.Total_Weight > 100000 and FIND_IN_SET(tvmt.Station_IP,#{stationPorts})
                            GROUP BY
                                province_station
                            ORDER BY
                                Total_Weight limit #{limit}
                        ) aa ON aa.Station_IP = ss.Station_Ip
                        WHERE
                            tvmt.Total_Weight BETWEEN 49000
                        AND 100000 and FIND_IN_SET(tvmt.Station_IP,#{stationPorts})
                        GROUP BY
                            province_station
                        ORDER BY
                            yiJi desc,province_station asc limit #{limit}
                    ) tb
                ORDER BY
                    tb.yiJi DESC
            ) ta
	</select>


    <sql id="limitSql">
        <if test='axlesCount=="2"'>
            ORDER BY chaoZai2CountMonth desc
        </if>
        <if test='axlesCount=="3"'>
            ORDER BY chaoZai3CountMonth desc
        </if>
        <if test='axlesCount=="4"'>
            ORDER BY chaoZai4CountMonth desc
        </if>
        <if test='axlesCount=="5"'>
            ORDER BY chaoZai5CountMonth desc
        </if>
        <if test='axlesCount=="6"'>
            ORDER BY chaoZai6CountMonth desc
        </if>
        <if test="limit!=null and limit!=''">
            LIMIT #{limit}
        </if>
    </sql>

    <select id="getDiTujwdByPort" resultType="CheLiuLiangEchartsList">
        SELECT
        group_concat(aa.cnt SEPARATOR ',') AS nums,
        group_concat(aa.Station_Port SEPARATOR ',') AS station_ports,
        group_concat(aa.station_name SEPARATOR ',') AS station_names,
				GROUP_CONCAT(CONCAT(aa.Station_Longitude,"-",aa.Station_Latitude)) as lnglat
        FROM
		(
			SELECT * FROM(SELECT
			COUNT(
				CASE
				WHEN a.Station_IP IS NOT NULL THEN
					0
				END
			) cnt,
			b.Station_Port,
			b.Station_Name,ss.Station_Longitude,ss.Station_Latitude
			FROM
				t_vehicle_msg_today a
			RIGHT JOIN station_site b ON a.Station_IP = b.Station_Port AND date(a.Evt_Time) = curdate()
			LEFT JOIN station_site ss on ss.Station_Port=b.Station_Port

			GROUP BY
        b.Station_Port
        HAVING FIND_IN_SET(b.Station_Port,#{stationPort})

        ORDER BY
        cnt DESC,b.Station_Name ASC

        )dd ORDER BY dd.cnt desc
        ) aa

    </select>

    <select id="getTodayzongliuliangAndzongchaozai" resultType="tjfxTotalEchars">
        SELECT
        sum(aa.cnta) as zongliuliangnum,sum(aa.cntc) as zongchaozainum
        FROM
        (
        SELECT
        COUNT( CASE WHEN a.Station_IP IS NOT NULL THEN 0 END ) cntc,
        b.Station_Port,
        b.Station_Name,
        cc.cnt AS cnta,
        (
        cc.cnt - COUNT( CASE WHEN a.Station_IP IS NOT NULL THEN 0 END )) AS cntt
        FROM
        t_vehicle_msg_today a
        RIGHT JOIN station_site b ON a.Station_IP = b.Station_Port
        AND a.Over_Weight > 0
        AND date( a.Evt_Time ) = curdate()
        AND a.Total_Weight &lt;(
        SELECT
        Crux_Weight
        FROM
        crux_weight
        WHERE
        Del_State = 1
        AND lv = 2
        )
        RIGHT JOIN (
        SELECT
        COUNT( 0 ) cntc
        FROM
        t_vehicle_msg_today
        WHERE
        Over_Weight > 0
        AND date( Evt_Time ) = curdate()
        AND FIND_IN_SET( Station_IP, #{stationPorts}
        )
        ) c ON 1 = 1
        RIGHT JOIN (
        SELECT
        COUNT( CASE WHEN a.Station_IP IS NOT NULL THEN 0 END ) cnt,
        bb.Station_Port,
        bb.Station_Name
        FROM
        t_vehicle_msg_today a
        RIGHT JOIN station_site bb ON a.Station_IP = bb.Station_Port
        AND date( a.Evt_Time ) = curdate()
        GROUP BY
        bb.Station_Port
        HAVING
        FIND_IN_SET( bb.Station_Port, #{stationPorts})
        ORDER BY cnt DESC, bb.Station_Name ) cc ON cc.Station_Port = b.Station_Port
        GROUP BY
        b.Station_Port
        HAVING
        FIND_IN_SET( b.Station_Port, #{stationPorts}
        )
        ORDER BY
        cntc DESC,
        cc.Station_Name
        ) aa
    </select>

    <select id="getsexTotalEchars" resultType="tjfxTotalEchars">
        SELECT
            a.Avg_Time,
            sum(a.Avg_Count) as zongliuliangnum,
            sum(a.Avg_Overload_Count) as zongchaozainum,
            sum(Range80Count2) as yijiyujingnum,
            sum(a.RangeCount3) as erjiyujingnum
        FROM
            t_avg_day a
        WHERE
            a.Avg_LaneNo = '0'  GROUP BY a.Avg_Time ORDER BY Avg_Time desc limit 6
    </select>

    <select id="getFirChaoZaiLv" resultType="CheLiuLiangEchartsList">
        SELECT
        aa.cntc  AS nums,
        aa.Station_Port AS station_ports,
        aa.station_name  AS station_names,
        aa.cnta  AS numCount,
        aa.cntt AS nums2,
        (aa.cntc / aa.cnta)  AS numsBili
        FROM
            (
            SELECT
            COUNT( CASE WHEN a.Station_IP IS NOT NULL THEN 0 END ) cntc,
            b.Station_Port,
            b.Station_Name,
            cc.cnt AS cnta,
            (
            cc.cnt - COUNT( CASE WHEN a.Station_IP IS NOT NULL THEN 0 END )) AS cntt
            FROM
            t_vehicle_msg_today a
            RIGHT JOIN station_site b ON a.Station_IP = b.Station_Port
            AND a.Over_Weight > 0
            AND date( a.Evt_Time ) = curdate()
            AND a.Total_Weight&lt;(
                SELECT
                Crux_Weight
                FROM
                crux_weight
                WHERE
                Del_State = 1
                AND lv = 2
            )
            <if test="link!=null and link!=''">
                and b.link = #{link}
            </if>
            RIGHT JOIN (
                SELECT
                COUNT( 0 ) cntc
                FROM
                t_vehicle_msg_today
                WHERE
                Over_Weight > 0
                AND date( Evt_Time ) = curdate()
                AND FIND_IN_SET( Station_IP, #{stationPorts}
                )
            ) c ON 1 = 1
            RIGHT JOIN (
                SELECT
                COUNT( CASE WHEN a.Station_IP IS NOT NULL THEN 0 END ) cnt,
                bb.Station_Port,
                bb.Station_Name
                FROM
                t_vehicle_msg_today a
                RIGHT JOIN station_site bb ON a.Station_IP = bb.Station_Port
                AND date( a.Evt_Time ) = curdate()
                GROUP BY
                bb.Station_Port
                HAVING
                FIND_IN_SET( bb.Station_Port, #{stationPorts})
                ORDER BY cnt DESC, bb.Station_Name
            ) cc ON cc.Station_Port = b.Station_Port
            GROUP BY
            b.Station_Port
            HAVING
            FIND_IN_SET( b.Station_Port, #{stationPorts}
            )
            ORDER BY
            cntc DESC,
            cc.Station_Name
        ) aa  ORDER BY numsBili desc
        <if test="limit!=null and limit!=''">
            LIMIT #{limit}
        </if>
    </select>
    
</mapper>

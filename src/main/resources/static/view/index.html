<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>实时监测</title>
		<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
		<link rel="stylesheet" type="text/css" href="css/home.css" />
		<link rel="stylesheet" type="text/css" href="css/layui.css" />
	</head>

	<body>
		<!--导航栏开始-->
		<div class="col-xs-12 daohang">
			<img src="img/首页logo.png" />
			<span>动态称重数据管理</span>
			<div class="rightD">
				<i></i>
				<p class="time">2019-11-20 15:20:14</p>
				<i></i>
				<p class="adm">admin</p>
				<i></i>
				<p class="tuichu">
					<a href="">退出</a>
				</p>
			</div>
		</div>
		<!--导航栏结束-->
		<!--左半部分开始-->
		<div id="leftTab">
			<a href="home.html" target="iframe_a">首页</a>
			<a href="shishijiance.html" target="iframe_a">实时监测</a>
			<a href="tongjifenxi.html" target="iframe_a">统计分析</a>
			<a href="">系统管理</a>
			<a href="renyuanguanli.html" target="iframe_a" >人员账户管理</a>
			<a href="jiancezhandian.html" target="iframe_a" >监测站点管理</a>
			<a href="zidianguanli.html" target="iframe_a" >字典管理</a>
			<ul class="layui-nav layui-nav-tree liebiao" lay-filter="test" >
				<!-- 侧边导航: <ul class="layui-nav layui-nav-tree layui-nav-side"> -->
				<li class="layui-nav-item layui-nav-itemed ">
					<a href="javascript:;">默认展开</a>
					<dl class="layui-nav-child">
						<dd>
							<a href="javascript:;">选项1</a>
						</dd>
						<dd>
							<a href="javascript:;">选项2</a>
						</dd>
						<dd>
							<a href="">跳转</a>
						</dd>
					</dl>
				</li>
			</ul>

		</div>

		<iframe name="iframe_a" width="100%" height="1500"></iframe>
	 <script src="js/layui.all.js" type="text/javascript" charset="utf-8"></script>
	 <script src="js/layui.js" type="text/javascript" charset="utf-8"></script>



		<script type="text/javascript">
			var user;
			$(document).ready(function() {

				$.ajax({
					type: "post",
					url: "/login/getUser",
					data: {},
					success: function(json) {
						user = json;
						if(json != null && json != "") {
							$("#uName").text(json.uName)
							$("#tuichu").text("退出")

						} else {
							$("#tuichu").text("登录")
						}
					}
				});
			})

			//easyui单击菜单可以打开关闭
			$('#caidandianjibangding').tree( {
				animate: true,
				onClick: function(node){
					$('#caidandianjibangding').tree(node.state === 'closed' ? 'expand' : 'collapse', node.target);
				}
			});


			$(function() {
				var nowHeight = $(window).height();
				$('.mian_iframe').height(nowHeight - 65);


			});

			var flag = true;
			$('#hetongLvyue').click(function() {
				if(flag) {
					$(".w_nav4").slideDown();
					flag = false;
				} else {
					$(".w_nav4").slideUp();
					flag = true;
				}
			});

			$(".inactive1").siblings('ul').slideUp();
			$(".inactive1").click(function() {
				if($(this).siblings('ul').css('display') == 'none') {
					$(this).siblings('ul').slideDown(300);
					//下面的if是为了控制同级菜单中都有子菜单只能打开一个
					if($(this).parents('li').siblings('li').children('ul').css('display') == 'block') {
						$(this).parents('li').siblings('li').children('ul').slideUp(300);
						console.log(4)
					}
				} else { //控制自身菜单下子菜单隐藏
					$(this).siblings('ul').slideUp(300);
					//控制自身菜单下子菜单隐藏
					$(this).siblings('ul').children('li').children('ul').slideUp(300);
				}

			});


			var flag2 = true;
			$(".w_nav4a").slideUp();
			$('#hetongLvyue2').click(function() {
				if(flag) {
					$(".w_nav4a").slideDown();
					flag = false;
				} else {
					$(".w_nav4a").slideUp();
					flag = true;
				}
			});
			var flag22 = true;
			$(".w_nav4aa").slideUp();
			$('#hetongLvyue22').click(function() {
				if(flag) {
					$(".w_nav4aa").slideDown();
					flag = false;
				} else {
					$(".w_nav4aa").slideUp();
					flag = true;
				}
			});



			//退出
			function exit() {
				$.ajax({
					type: "post",
					url: "/login/exit",
					async: false,
					data: {},
					success: function(json) {
						localStorage.removeItem("obj");
						location.href = "./login.html";
					}
				})
			}

			function tanchulai() {
				$("#old_password").val("")
				$("#new_password").val("")
				$("#new_password2").val("")
				$("#change").modal("show")
			}

			function save_new_password() {
				var old_password = $("#old_password").val();
				var new_password = $("#new_password").val();
				var new_password2 = $("#new_password2").val();
				if(new_password2 != new_password) {
					toastr.error("两次输入新密码不一致");
					return;
				}
				//console.log(user)
				var password = old_password + "," + new_password
				$.ajax({
					type: "post",
					url: "/user/updatePasswordById",
					data: {
						userId: user.userId,
						password: password
					},
					success: function(json) {
						if(json > 0) {
							toastr.success("修改成功")
							$("#change").modal("hide")
						} else if(json == -1) {
							toastr.error("原密码不正确")
						} else if(json == -2) {
							toastr.error("新密码与原密码请保持不一致")
						}
					}
				})
			}

			let node = $('#caidandianjibangding').tree('find', 'syLi');
			$('#caidandianjibangding').tree('select', node.target);
			$("#syAId").trigger('click');

			/*登录时保持session不会消失*/
			var keepSession = setInterval(function () {
				$.ajax({
					type:"POST",
					url:"/login/keepSession",
					success:function(result){
						if(result==1){
							console.log("保持session状态不消失");
						}
					},
				})
			},300000);
		</script>
	</body>
</html>
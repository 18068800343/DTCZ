<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link href="../style/bootstrap.min.css" rel="stylesheet"/>
    <link href="../font3/bootstrap-select.css" rel="stylesheet">
    <link href="../font2/iconfont.css" rel="stylesheet">
    <link rel="stylesheet" href="../style/jquery.dataTables.min.css">
    <link href="../style/style.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/home.css"/>
    <!--<link rel="stylesheet" type="text/css" href="css/layui.css" />-->
    <link rel="stylesheet" href="css/toastr.css"/>
    <style>
        #mainContent_info {
            margin-left: 5%;
        }

        #mainContent_paginate {
            margin-right: 5%;
        }

        .xian {
            margin-top: 3.5%;
        }
    </style>
</head>
<body style="background-image: none;">
<div class="form-group" id="rightTab">
    <div id="mainVm">
        <div class="sele">
            <label class="col-sm-2 control-label">重量范围</label>
            <div class="col-sm-2">
                <!-- 样式1 -->
                <input type="text" value="请输入" v-model="startWeight" @input="checknum('startWeight')"
                       style="height: 34px;border-radius: 5px;box-shadow: none;width: 250%;border:1px solid #DDD;padding:3px;">
            </div>

            <div class="col-sm-2" style="margin-left: 6%;">
                <div class="xian2"
                     style="width: 10px;height: 2px;background-color: #DEDEDE;position: absolute;margin-left: 8%;margin-top: 15%;">
                </div>
                <input type="text" value="请输入" v-model="endWeight" @input="checknum('endWeight')" style="height: 34px;border-radius: 5px;box-shadow: none;width:
        250%;margin-left: 30px;border:1px solid #DDD;padding:3px;">
            </div>
        </div>

        <label class="col-sm-1	 control-label" style="margin-left: 9%;width: 70px;line-height: 30px;">日期:</label>
        <div class="col-sm-2">
            <!-- 样式1 -->
            <input type="date" v-model="startTime" value="请选择"
                   style="height: 34px;border-radius: 5px;box-shadow: none;width: 250%;border:1px solid #DDD;">
        </div>

        <button type="button" class="btn btn-primary" onclick="nowJianceSite()" data-toggle="modal"
                data-target="#jianceDiv"
                style="width: 150px; position:relative;top:43px;right:14%;background-image: linear-gradient(#1F62C8,#262E9F);">
            当前监测站点
        </button>
        <div class="col-sm-2" style="margin-left: 6%;">
            <div class="xian2"
                 style="width: 10px;height: 2px;background-color: #DEDEDE;position: absolute;margin-left: 8%;margin-top: 15%;">
            </div>
            <input type="date" v-model="endTime" value="请选择" style="height: 34px;border-radius: 5px;box-shadow: none;width:
        250%;margin-left: 30px;border:1px solid #DDD;">
        </div>
        <label class="col-sm-1	 control-label" style="margin-left: 9%; width: 70px; line-height: 30px;">车型:</label>
        <div class="col-sm-2" style="margin-left: 1%;">
            <div class="xian2"
                 style="width: 10px; height: 2px; background-color: rgb(222, 222, 222); position: absolute; margin-left: 5%; margin-top: 15%;"></div>
            <select  value="请选择" class="selectpicker" multiple data-max-options="1" data-live-search="true" id="chexing"
                   style="height: 34px; border-radius: 5px; box-shadow: none; margin-left: 30px; border: 1px solid rgb(221, 221, 221);"></select>
        </div>

        <div class="sele">
            <label for="" class="col-sm-2 control-label">筛选站点</label>
            <div class="col-sm-2" style="width: 29%">
                <!-- 样式1 -->
                <select class="form-control selectpicker" multiple data-max-options="2" data-live-search="true"
                        id="zhandian" style="width:80%;">
                </select>
            </div>
            <div class="jiance">
                <button type="button" class="btn btn-primary" @click="searchInit"
                        style="width: 150px; background-image: linear-gradient(#1F62C8,#262E9F);">确定
                </button>

            </div>
        </div>
    </div>
    <div class="xian"></div>
    <!--表格-->
    <table class="table table-striped table-hover" id="mainContent"
           style="width: 90%;margin: 0 auto; margin-top: 20px;">
        <thead style="background-color: #DDE6F7;">
        <tr>
            <th style="width: 15%">站点</th>
            <th>车道号</th>
            <th>车牌号</th>
            <th>车牌颜色</th>
            <th>车型</th>
            <th>长</th>
            <th>车速(Km/h)</th>
            <th>行驶方向</th>
            <th>轴数</th>
            <th>总重量(Kg)</th>
            <th>是否跨道</th>
            <th>路面温度</th>
            <th>超重比率</th>
            <th>时间</th>
        </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>

<!-- allMsg -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
     id="jianceDiv">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title"><b>当前监测站点</b></h4>
            </div>
            <div class="modal-body">
                <div>
                    <form class="form-inline">
                        <table class="table table-bordered table-condensed" style="height: auto;" id="jianceTable">
                            <tbody>

                            </tbody>
                        </table>
                    </form>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            </div>
        </div>
    </div>
</div>

</body>
<script src="../js/jquery.js"></script>
<script src="../js/bootstrap.min.js"></script>
<script src="../js/bootstrap-select.js"></script>
<script src="js/echarts.min(1).js" type="text/javascript" charset="utf-8"></script>
<script src="js/datatables/jquery.dataTables.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.staticfile.org/vue-resource/1.5.1/vue-resource.min.js"></script>
<script src="../js/common-scripts.js"></script>
<script src="../js/echartsOptionInit.js"></script>
<script src="js/toastr.js"></script>
<script src="../js/myTool.js"></script>
<script>
    $(document).ready(function () {
        initzhandian();
        initchexing();
    });

    let table = $('#mainContent').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 10,
        "searching": false,
        "bLengthChange": false,
        'paging': true,
        "oLanguage": {
            "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
        },
        "columns": [
            {"data": "stationNameRouteName"},
            {"data": "laneNo"},
            {"data": "plate"},
            {"data": "licensePlateColor"},
            {"data": "vehicleTypeName"},
            {"data": "length"},
            {"data": "speed"},
            {"data": "directionName"},
            {"data": "axlesCount"},
            {"data": "totalWeight"},
            {"data": "isStraddleName"},
            {"data": "temperature"},
            {"data": "overWeightRatio"},
            {"data": "evtTime"},

        ],
        "columnDefs": [{
            "class": "tcenter",
            "targets": 0,
            "searchable": true,
            "render": function (data, type, full) {
                return "<marquee scrollAmount=3>" + data + "</marquee>";
            }
        },{
            "class": "tcenter",
            "targets": 13,
            "searchable": true,
            "render": function (data, type, full) {
                return "<marquee scrollAmount=3>" + data + "</marquee>";
            }
        },],
        "order": [[0, 'asc']],
        "oLanguage": { //国际化配置
            "sProcessing": "正在获取数据，请稍后...",
            "sLengthMenu": "显示 _MENU_ 条",
            "sZeroRecords": "查询不到相关数据",
            "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
            "sInfoEmpty": "记录数为0",
            "sInfoFiltered": "(全部记录数 _MAX_ 条)",
            "sInfoPostFix": "",
            "sSearch": "搜索",
            "sUrl": "",
            "oPaginate": {
                "sFirst": "第一页",
                "sPrevious": "上一页",
                "sNext": "下一页",
                "sLast": "最后一页"
            }
        },

    });

    let user;

    function initzhandian() {
        $.ajax({
            type: 'POST',
            url: '/login/getUser',
            dataType: 'json',
            async: false,
            data: {},
            error: function (msg) {
            },
            success: function (json) {
                user = json;
                $("#zhandian").html('');
                if (json != null) {
                    if (json.stationPort.indexOf(",") != -1 && json.stationName.indexOf(",") != -1) {
                        let stationPort = json.stationPort.split(",");
                        let stationName = json.stationName.split(",");
                        for (let i = 0; i < stationPort.length; i++) {
                            $("#zhandian").append("<option  value='" + stationPort[i] + "'>" + stationName[i] + "</option>");
                        }
                    } else {
                        $("#zhandian").append("<option  value='" + json.stationPort + "'>" + json.stationName + "</option>");
                    }
                    $(".selectpicker").selectpicker({
                        noneSelectedText: '请选择',
                    });
                    if (user.lastMonitoringSite != null && user.lastMonitoringSite != "" && user.lastMonitoringSite != undefined) {
                        if (user.lastMonitoringSite.indexOf(",") != -1) {
                            $("#zhandian").val(user.lastMonitoringSite.split(","));
                            $('#zhandian').selectpicker('val', user.lastMonitoringSite.split(","));
                        } else {
                            $("#zhandian").val(user.lastMonitoringSite);
                            $('#zhandian').selectpicker('val', user.lastMonitoringSite);
                        }

                    }
                    $("#zhandian").selectpicker("refresh");
                    $('#zhandian').selectpicker('render');
                }
            }
        });
    }
    function initchexing() {
        $.ajax({
            type: 'POST',
            url: '/VehicleType/getVehicleType',
            dataType: 'json',
            async: false,
            data: {},
            error: function (msg) {
            },
            success: function (json) {
                $("#chexing").html('');
                if (json != null) {
                        for (let i in json) {
                            $("#chexing").append("<option  value='" + json[i].vehicleTypeId + "'>" + json[i].vehicleTypeName + "</option>");
                        }
                    $(".selectpicker").selectpicker({
                        noneSelectedText: '请选择',
                    });
                    $("#chexing").selectpicker("refresh");
                    $('#chexing').selectpicker('render');
                }
            }
        });
    }

    //新建生产计划
    let mainVm = new Vue({
        el: '#mainVm',
        //表单数据
        data: {
            zhandian: [],
            stationPort: "",
            startTime: "",
            endTime: "",
            endWeight: "",
            startWeight: "",
            chexing:"",
        },
        methods: {
            //新建生产计划保存按钮事件
            searchInit: function () {
                showMask();
                this.stationPort = $("#zhandian").val() == null ? "" : $("#zhandian").val().toString();
                this.chexing = $("#chexing").val() == null ? "" : $("#chexing").val().toString();
                //发送 post 请求  then中第一个function或者箭头函数为success回调函数, 第二个function为失败fail回调函数
                this.$http.post('/tWimMsg/getAlltWimMsgByCondiTion', this._data, {emulateJSON: true}).then((res) => {

                    $('#mainContent').dataTable().fnClearTable();
                    $('#mainContent').DataTable().rows.add(res.body).draw(false);
                    hidMask();

                }, (res) => {

                });
            },
            checknum: function (msg) {
                this._data[msg] = this._data[msg].replace(/[^\d.]/g, '');
                let str = this._data[msg].split('.');
                if (str.length > 2) {
                    this._data[msg] = this._data[msg].substr(0, this._data[msg].length - 1);
                }
            },
            init: function () {

            },
        }
    });

    $("#less").click(function () {
        let divV = document.getElementById("Two");
        if (divV.style.display == "none") {
            divV.style.display = "block";
            //$("#Two").attr("style","display:block;");//显示div
        } else {
            divV.style.display = "none";
        }
    })

    function nowJianceSite(){
        $("#jianceTable tbody").empty('')
        if($("#zhandian").val()!=""&&$("#zhandian").val()!=undefined&&$("#zhandian").val()!=null){
            var text=[];
            var checkParam = $('#zhandian').find('option:selected');
            for (var i=0;i<checkParam.length;i++) {
                text.push(checkParam[i].textContent);
            }
            for(i in text){
                $("#jianceTable tbody").append("<tr><td colspan='2'>"+text[i]+"<td></tr>")
                $("#jianceTable tbody").find("td:last").hide()
            }
        }else{
            $("#zhandian option").each(function(){
                //遍历所有option
                var value = $(this).val();   //获取option值
                var text = $(this).text();
                if(text!=''){
                    $("#jianceTable tbody").append("<tr><td colspan='2'>"+text+"<td></tr>")
                    $("#jianceTable tbody").find("td:last").hide()
                }
            })
        }

    }

    function showMask() {
        myTool.mask.show('查询中...');
    }
    function hidMask() {
        myTool.mask.hide();
    }

    mainVm.searchInit();
</script>


</html>
